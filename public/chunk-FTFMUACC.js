import{d as Gl}from"./chunk-6VCXNJ72.js";import{E as go,K as un,P as rr,a as q,b as be,c as nr,f as mo,h as oi,j as ai,k as ci,p as zl,x as ui}from"./chunk-U4S3JRSN.js";function Rm(n){let e=[];if(!n)return{valid:!1,errors:["Password is required"],strength:"weak"};n.length<8&&e.push("Password must be at least 8 characters long"),/[A-Z]/.test(n)||e.push("Password must contain at least one uppercase letter"),/[a-z]/.test(n)||e.push("Password must contain at least one lowercase letter"),/[0-9]/.test(n)||e.push("Password must contain at least one number");let t="weak";return e.length===0&&(n.length>=12&&/[!@#$%^&*(),.?":{}|<>]/.test(n)?t="strong":n.length>=8&&(t="medium")),{valid:e.length===0,errors:e,strength:t}}function Fw(){return n=>{let e=n.value;if(!e)return null;let t=Rm(e);return t.valid?null:{passwordStrength:t.errors}}}function Uw(n){return e=>{if(!e.parent)return null;let t=e.parent.get(n)?.value,r=e.value;return r?t===r?null:{passwordMismatch:!0}:null}}function _o(n){let e={"auth/email-already-in-use":"This email is already registered. Please sign in instead.","auth/invalid-email":"Please enter a valid email address.","auth/operation-not-allowed":"Email/password accounts are not enabled. Please contact support.","auth/weak-password":"Password should be at least 8 characters long with uppercase, lowercase, and numbers.","auth/user-disabled":"This account has been disabled. Please contact support.","auth/user-not-found":"No account found with this email. Please sign up first.","auth/wrong-password":"Incorrect password. Please try again.","auth/invalid-credential":"Invalid email or password. Please check your credentials.","auth/invalid-login-credentials":"Invalid email or password. Please check your credentials.","auth/network-request-failed":"Network error. Please check your internet connection and try again.","auth/too-many-requests":"Too many failed attempts. Please try again later.","auth/popup-closed-by-user":"Sign-in popup was closed. Please try again.","auth/cancelled-popup-request":"Sign-in was cancelled. Please try again.","auth/missing-password":"Please enter your password.","auth/missing-email":"Please enter your email address."};return e[n]||console.warn("Unknown Firebase error code:",n),e[n]||"Authentication failed. Please check your credentials and try again."}var $l=()=>{};var Hl=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Pm=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[t++],a=n[t++],u=n[t++],h=((i&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Ql={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,u=a?n[i+1]:0,h=i+2<n.length,d=h?n[i+2]:0,p=o>>2,y=(o&3)<<4|u>>4,w=(u&15)<<2|d>>6,R=d&63;h||(R=64,a||(w=64)),r.push(t[p],t[y],t[w],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Hl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Pm(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let y=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||u==null||d==null||y==null)throw new Io;let w=o<<2|u>>4;if(r.push(w),d!==64){let R=u<<4&240|d>>2;if(r.push(R),y!==64){let D=d<<6&192|y;r.push(D)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Io=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Cm=function(n){let e=Hl(n);return Ql.encodeByteArray(e,!0)},sr=function(n){return Cm(n).replace(/\./g,"")},hi=function(n){try{return Ql.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Jl(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Nm=()=>Jl().__FIREBASE_DEFAULTS__,km=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Dm=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&hi(n[1]);return e&&JSON.parse(e)},di=()=>{try{return $l()||Nm()||km()||Dm()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Eo=n=>di()?.emulatorHosts?.[n],Yl=n=>{let e=Eo(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},To=()=>di()?.config,vo=n=>di()?.[`_${n}`];var li=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function _t(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function fi(n){return(await fetch(n,{credentials:"include"})).ok}function Xl(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=q({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[sr(JSON.stringify(t)),sr(JSON.stringify(a)),""].join(".")}var ir={};function Om(){let n={prod:[],emulator:[]};for(let e of Object.keys(ir))ir[e]?n.emulator.push(e):n.prod.push(e);return n}function Vm(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var Kl=!1;function pi(n,e){if(typeof window>"u"||typeof document>"u"||!_t(window.location.host)||ir[n]===e||ir[n]||Kl)return;ir[n]=e;function t(w){return`__firebase__banner__${w}`}let r="__firebase__banner",o=Om().prod.length>0;function a(){let w=document.getElementById(r);w&&w.remove()}function u(w){w.style.display="flex",w.style.background="#7faaf0",w.style.position="fixed",w.style.bottom="5px",w.style.left="5px",w.style.padding=".5em",w.style.borderRadius="5px",w.style.alignItems="center"}function h(w,R){w.setAttribute("width","24"),w.setAttribute("id",R),w.setAttribute("height","24"),w.setAttribute("viewBox","0 0 24 24"),w.setAttribute("fill","none"),w.style.marginLeft="-6px"}function d(){let w=document.createElement("span");return w.style.cursor="pointer",w.style.marginLeft="16px",w.style.fontSize="24px",w.innerHTML=" &times;",w.onclick=()=>{Kl=!0,a()},w}function p(w,R){w.setAttribute("id",R),w.innerText="Learn more",w.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",w.setAttribute("target","__blank"),w.style.paddingLeft="5px",w.style.textDecoration="underline"}function y(){let w=Vm(r),R=t("text"),D=document.getElementById(R)||document.createElement("span"),O=t("learnmore"),C=document.getElementById(O)||document.createElement("a"),j=t("preprendIcon"),W=document.getElementById(j)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(w.created){let H=w.element;u(H),p(C,O);let ye=d();h(W,j),H.append(W,D,C,ye),document.body.appendChild(H)}o?(D.innerText="Preview backend disconnected.",W.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(W.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,D.innerText="Preview backend running in this workspace."),D.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",y):y()}function de(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Zl(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(de())}function xm(){let n=di()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function eh(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function th(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function nh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function rh(){let n=de();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ih(){return!xm()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ao(){try{return typeof indexedDB=="object"}catch{return!1}}function sh(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}var Lm="FirebaseError",Se=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Lm,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Je.prototype.create)}},Je=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?Mm(o,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new Se(i,u,r)}};function Mm(n,e){return n.replace(Fm,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Fm=/\{\$([^}]+)}/g;function oh(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ue(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let o=n[i],a=e[i];if(Wl(o)&&Wl(a)){if(!Ue(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Wl(n){return n!==null&&typeof n=="object"}function or(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ln(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,o]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(o)}}),e}function hn(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function ah(n,e){let t=new wo(n,e);return t.subscribe.bind(t)}var wo=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Um(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=yo),i.error===void 0&&(i.error=yo),i.complete===void 0&&(i.complete=yo);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Um(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function yo(){}var zw=14400*1e3;function ne(n){return n&&n._delegate?n._delegate:n}var Ne=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var qt="[DEFAULT]";var bo=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new li;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(qm(e))try{this.getOrInitializeService({instanceIdentifier:qt})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=qt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=qt){return this.instances.has(e)}getOptions(e=qt){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[o,a]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(i)}return i}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);let o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Bm(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=qt){return this.component?this.component.multipleInstances?e:qt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Bm(n){return n===qt?void 0:n}function qm(n){return n.instantiationMode==="EAGER"}var mi=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new bo(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var jm=[],z=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(z||{}),zm={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},Gm=z.INFO,$m={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},Km=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=$m[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},yt=class{constructor(e){this.name=e,this._logLevel=Gm,this._logHandler=Km,this._userLogHandler=null,jm.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?zm[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...e),this._logHandler(this,z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...e),this._logHandler(this,z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,z.INFO,...e),this._logHandler(this,z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,z.WARN,...e),this._logHandler(this,z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...e),this._logHandler(this,z.ERROR,...e)}};var Wm=(n,e)=>e.some(t=>n instanceof t),ch,uh;function Hm(){return ch||(ch=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Qm(){return uh||(uh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var lh=new WeakMap,Ro=new WeakMap,hh=new WeakMap,So=new WeakMap,Co=new WeakMap;function Jm(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(Be(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&lh.set(t,n)}).catch(()=>{}),Co.set(e,n),e}function Ym(n){if(Ro.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Ro.set(n,e)}var Po={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ro.get(n);if(e==="objectStoreNames")return n.objectStoreNames||hh.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Be(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function dh(n){Po=n(Po)}function Xm(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(gi(this),e,...t);return hh.set(r,e.sort?e.sort():[e]),Be(r)}:Qm().includes(n)?function(...e){return n.apply(gi(this),e),Be(lh.get(this))}:function(...e){return Be(n.apply(gi(this),e))}}function Zm(n){return typeof n=="function"?Xm(n):(n instanceof IDBTransaction&&Ym(n),Wm(n,Hm())?new Proxy(n,Po):n)}function Be(n){if(n instanceof IDBRequest)return Jm(n);if(So.has(n))return So.get(n);let e=Zm(n);return e!==n&&(So.set(n,e),Co.set(e,n)),e}var gi=n=>Co.get(n);function ph(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,e),u=Be(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Be(a.result),h.oldVersion,h.newVersion,Be(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}var eg=["get","getKey","getAll","getAllKeys","count"],tg=["put","add","delete","clear"],No=new Map;function fh(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(No.get(e))return No.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=tg.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||eg.includes(t)))return;let o=async function(a,...u){let h=this.transaction(a,i?"readwrite":"readonly"),d=h.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[t](...u),i&&h.done]))[0]};return No.set(e,o),o}dh(n=>be(q({},n),{get:(e,t,r)=>fh(e,t)||n.get(e,t,r),has:(e,t)=>!!fh(e,t)||n.has(e,t)}));var Do=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(ng(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function ng(n){return n.getComponent()?.type==="VERSION"}var Oo="@firebase/app",mh="0.14.6";var Ye=new yt("@firebase/app"),rg="@firebase/app-compat",ig="@firebase/analytics-compat",sg="@firebase/analytics",og="@firebase/app-check-compat",ag="@firebase/app-check",cg="@firebase/auth",ug="@firebase/auth-compat",lg="@firebase/database",hg="@firebase/data-connect",dg="@firebase/database-compat",fg="@firebase/functions",pg="@firebase/functions-compat",mg="@firebase/installations",gg="@firebase/installations-compat",_g="@firebase/messaging",yg="@firebase/messaging-compat",Ig="@firebase/performance",wg="@firebase/performance-compat",Eg="@firebase/remote-config",Tg="@firebase/remote-config-compat",vg="@firebase/storage",Ag="@firebase/storage-compat",bg="@firebase/firestore",Sg="@firebase/ai",Rg="@firebase/firestore-compat",Pg="firebase",Cg="12.6.0";var Vo="[DEFAULT]",Ng={[Oo]:"fire-core",[rg]:"fire-core-compat",[sg]:"fire-analytics",[ig]:"fire-analytics-compat",[ag]:"fire-app-check",[og]:"fire-app-check-compat",[cg]:"fire-auth",[ug]:"fire-auth-compat",[lg]:"fire-rtdb",[hg]:"fire-data-connect",[dg]:"fire-rtdb-compat",[fg]:"fire-fn",[pg]:"fire-fn-compat",[mg]:"fire-iid",[gg]:"fire-iid-compat",[_g]:"fire-fcm",[yg]:"fire-fcm-compat",[Ig]:"fire-perf",[wg]:"fire-perf-compat",[Eg]:"fire-rc",[Tg]:"fire-rc-compat",[vg]:"fire-gcs",[Ag]:"fire-gcs-compat",[bg]:"fire-fst",[Rg]:"fire-fst-compat",[Sg]:"fire-vertex","fire-js":"fire-js",[Pg]:"fire-js-all"};var _i=new Map,kg=new Map,xo=new Map;function gh(n,e){try{n.container.addComponent(e)}catch(t){Ye.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function wt(n){let e=n.name;if(xo.has(e))return Ye.debug(`There were multiple attempts to register component ${e}.`),!1;xo.set(e,n);for(let t of _i.values())gh(t,n);for(let t of kg.values())gh(t,n);return!0}function cr(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ve(n){return n==null?!1:n.settings!==void 0}var Dg={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},It=new Je("app","Firebase",Dg);var Lo=class{constructor(e,t,r){this._isDeleted=!1,this._options=q({},e),this._config=q({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ne("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw It.create("app-deleted",{appName:this._name})}};var Et=Cg;function ur(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=q({name:Vo,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw It.create("bad-app-name",{appName:String(i)});if(t||(t=To()),!t)throw It.create("no-options");let o=_i.get(i);if(o){if(Ue(t,o.options)&&Ue(r,o.config))return o;throw It.create("duplicate-app",{appName:i})}let a=new mi(i);for(let h of xo.values())a.addComponent(h);let u=new Lo(t,r,a);return _i.set(i,u),u}function yi(n=Vo){let e=_i.get(n);if(!e&&n===Vo&&To())return ur();if(!e)throw It.create("no-app",{appName:n});return e}function Oe(n,e,t){let r=Ng[n]??n;t&&(r+=`-${t}`);let i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){let a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ye.warn(a.join(" "));return}wt(new Ne(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var Og="firebase-heartbeat-database",Vg=1,ar="firebase-heartbeat-store",ko=null;function wh(){return ko||(ko=ph(Og,Vg,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ar)}catch(t){console.warn(t)}}}}).catch(n=>{throw It.create("idb-open",{originalErrorMessage:n.message})})),ko}async function xg(n){try{let t=(await wh()).transaction(ar),r=await t.objectStore(ar).get(Eh(n));return await t.done,r}catch(e){if(e instanceof Se)Ye.warn(e.message);else{let t=It.create("idb-get",{originalErrorMessage:e?.message});Ye.warn(t.message)}}}async function _h(n,e){try{let r=(await wh()).transaction(ar,"readwrite");await r.objectStore(ar).put(e,Eh(n)),await r.done}catch(t){if(t instanceof Se)Ye.warn(t.message);else{let r=It.create("idb-set",{originalErrorMessage:t?.message});Ye.warn(r.message)}}}function Eh(n){return`${n.name}!${n.options.appId}`}var Lg=1024,Mg=30,Mo=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Fo(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{let t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=yh();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Mg){let i=Ug(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ye.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=yh(),{heartbeatsToSend:t,unsentEntries:r}=Fg(this._heartbeatsCache.heartbeats),i=sr(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Ye.warn(e),""}}};function yh(){return new Date().toISOString().substring(0,10)}function Fg(n,e=Lg){let t=[],r=n.slice();for(let i of n){let o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),Ih(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Ih(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Fo=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ao()?sh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let t=await xg(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){let r=await this.read();return _h(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){let r=await this.read();return _h(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}};function Ih(n){return sr(JSON.stringify({version:2,heartbeats:n})).length}function Ug(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Bg(n){wt(new Ne("platform-logger",e=>new Do(e),"PRIVATE")),wt(new Ne("heartbeat",e=>new Mo(e),"PRIVATE")),Oe(Oo,mh,n),Oe(Oo,mh,"esm2020"),Oe("fire-js","")}Bg("");var Th=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},vh={};var Xe,Uo;(function(){var n;function e(E,m){function _(){}_.prototype=m.prototype,E.F=m.prototype,E.prototype=new _,E.prototype.constructor=E,E.D=function(T,I,A){for(var g=Array(arguments.length-2),Te=2;Te<arguments.length;Te++)g[Te-2]=arguments[Te];return m.prototype[I].apply(T,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,m,_){_||(_=0);let T=Array(16);if(typeof m=="string")for(var I=0;I<16;++I)T[I]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(I=0;I<16;++I)T[I]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=E.g[0],_=E.g[1],I=E.g[2];let A=E.g[3],g;g=m+(A^_&(I^A))+T[0]+3614090360&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(I^m&(_^I))+T[1]+3905402710&4294967295,A=m+(g<<12&4294967295|g>>>20),g=I+(_^A&(m^_))+T[2]+606105819&4294967295,I=A+(g<<17&4294967295|g>>>15),g=_+(m^I&(A^m))+T[3]+3250441966&4294967295,_=I+(g<<22&4294967295|g>>>10),g=m+(A^_&(I^A))+T[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(I^m&(_^I))+T[5]+1200080426&4294967295,A=m+(g<<12&4294967295|g>>>20),g=I+(_^A&(m^_))+T[6]+2821735955&4294967295,I=A+(g<<17&4294967295|g>>>15),g=_+(m^I&(A^m))+T[7]+4249261313&4294967295,_=I+(g<<22&4294967295|g>>>10),g=m+(A^_&(I^A))+T[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(I^m&(_^I))+T[9]+2336552879&4294967295,A=m+(g<<12&4294967295|g>>>20),g=I+(_^A&(m^_))+T[10]+4294925233&4294967295,I=A+(g<<17&4294967295|g>>>15),g=_+(m^I&(A^m))+T[11]+2304563134&4294967295,_=I+(g<<22&4294967295|g>>>10),g=m+(A^_&(I^A))+T[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(I^m&(_^I))+T[13]+4254626195&4294967295,A=m+(g<<12&4294967295|g>>>20),g=I+(_^A&(m^_))+T[14]+2792965006&4294967295,I=A+(g<<17&4294967295|g>>>15),g=_+(m^I&(A^m))+T[15]+1236535329&4294967295,_=I+(g<<22&4294967295|g>>>10),g=m+(I^A&(_^I))+T[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^I&(m^_))+T[6]+3225465664&4294967295,A=m+(g<<9&4294967295|g>>>23),g=I+(m^_&(A^m))+T[11]+643717713&4294967295,I=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(I^A))+T[0]+3921069994&4294967295,_=I+(g<<20&4294967295|g>>>12),g=m+(I^A&(_^I))+T[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^I&(m^_))+T[10]+38016083&4294967295,A=m+(g<<9&4294967295|g>>>23),g=I+(m^_&(A^m))+T[15]+3634488961&4294967295,I=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(I^A))+T[4]+3889429448&4294967295,_=I+(g<<20&4294967295|g>>>12),g=m+(I^A&(_^I))+T[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^I&(m^_))+T[14]+3275163606&4294967295,A=m+(g<<9&4294967295|g>>>23),g=I+(m^_&(A^m))+T[3]+4107603335&4294967295,I=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(I^A))+T[8]+1163531501&4294967295,_=I+(g<<20&4294967295|g>>>12),g=m+(I^A&(_^I))+T[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^I&(m^_))+T[2]+4243563512&4294967295,A=m+(g<<9&4294967295|g>>>23),g=I+(m^_&(A^m))+T[7]+1735328473&4294967295,I=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(I^A))+T[12]+2368359562&4294967295,_=I+(g<<20&4294967295|g>>>12),g=m+(_^I^A)+T[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^I)+T[8]+2272392833&4294967295,A=m+(g<<11&4294967295|g>>>21),g=I+(A^m^_)+T[11]+1839030562&4294967295,I=A+(g<<16&4294967295|g>>>16),g=_+(I^A^m)+T[14]+4259657740&4294967295,_=I+(g<<23&4294967295|g>>>9),g=m+(_^I^A)+T[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^I)+T[4]+1272893353&4294967295,A=m+(g<<11&4294967295|g>>>21),g=I+(A^m^_)+T[7]+4139469664&4294967295,I=A+(g<<16&4294967295|g>>>16),g=_+(I^A^m)+T[10]+3200236656&4294967295,_=I+(g<<23&4294967295|g>>>9),g=m+(_^I^A)+T[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^I)+T[0]+3936430074&4294967295,A=m+(g<<11&4294967295|g>>>21),g=I+(A^m^_)+T[3]+3572445317&4294967295,I=A+(g<<16&4294967295|g>>>16),g=_+(I^A^m)+T[6]+76029189&4294967295,_=I+(g<<23&4294967295|g>>>9),g=m+(_^I^A)+T[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^I)+T[12]+3873151461&4294967295,A=m+(g<<11&4294967295|g>>>21),g=I+(A^m^_)+T[15]+530742520&4294967295,I=A+(g<<16&4294967295|g>>>16),g=_+(I^A^m)+T[2]+3299628645&4294967295,_=I+(g<<23&4294967295|g>>>9),g=m+(I^(_|~A))+T[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~I))+T[7]+1126891415&4294967295,A=m+(g<<10&4294967295|g>>>22),g=I+(m^(A|~_))+T[14]+2878612391&4294967295,I=A+(g<<15&4294967295|g>>>17),g=_+(A^(I|~m))+T[5]+4237533241&4294967295,_=I+(g<<21&4294967295|g>>>11),g=m+(I^(_|~A))+T[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~I))+T[3]+2399980690&4294967295,A=m+(g<<10&4294967295|g>>>22),g=I+(m^(A|~_))+T[10]+4293915773&4294967295,I=A+(g<<15&4294967295|g>>>17),g=_+(A^(I|~m))+T[1]+2240044497&4294967295,_=I+(g<<21&4294967295|g>>>11),g=m+(I^(_|~A))+T[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~I))+T[15]+4264355552&4294967295,A=m+(g<<10&4294967295|g>>>22),g=I+(m^(A|~_))+T[6]+2734768916&4294967295,I=A+(g<<15&4294967295|g>>>17),g=_+(A^(I|~m))+T[13]+1309151649&4294967295,_=I+(g<<21&4294967295|g>>>11),g=m+(I^(_|~A))+T[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~I))+T[11]+3174756917&4294967295,A=m+(g<<10&4294967295|g>>>22),g=I+(m^(A|~_))+T[2]+718787259&4294967295,I=A+(g<<15&4294967295|g>>>17),g=_+(A^(I|~m))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+m&4294967295,E.g[1]=E.g[1]+(I+(g<<21&4294967295|g>>>11))&4294967295,E.g[2]=E.g[2]+I&4294967295,E.g[3]=E.g[3]+A&4294967295}r.prototype.v=function(E,m){m===void 0&&(m=E.length);let _=m-this.blockSize,T=this.C,I=this.h,A=0;for(;A<m;){if(I==0)for(;A<=_;)i(this,E,A),A+=this.blockSize;if(typeof E=="string"){for(;A<m;)if(T[I++]=E.charCodeAt(A++),I==this.blockSize){i(this,T),I=0;break}}else for(;A<m;)if(T[I++]=E[A++],I==this.blockSize){i(this,T),I=0;break}}this.h=I,this.o+=m},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var m=1;m<E.length-8;++m)E[m]=0;m=this.o*8;for(var _=E.length-8;_<E.length;++_)E[_]=m&255,m/=256;for(this.v(E),E=Array(16),m=0,_=0;_<4;++_)for(let T=0;T<32;T+=8)E[m++]=this.g[_]>>>T&255;return E};function o(E,m){var _=u;return Object.prototype.hasOwnProperty.call(_,E)?_[E]:_[E]=m(E)}function a(E,m){this.h=m;let _=[],T=!0;for(let I=E.length-1;I>=0;I--){let A=E[I]|0;T&&A==m||(_[I]=A,T=!1)}this.g=_}var u={};function h(E){return-128<=E&&E<128?o(E,function(m){return new a([m|0],m<0?-1:0)}):new a([E|0],E<0?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return y;if(E<0)return C(d(-E));let m=[],_=1;for(let T=0;E>=_;T++)m[T]=E/_|0,_*=4294967296;return new a(m,0)}function p(E,m){if(E.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(E.charAt(0)=="-")return C(p(E.substring(1),m));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');let _=d(Math.pow(m,8)),T=y;for(let A=0;A<E.length;A+=8){var I=Math.min(8,E.length-A);let g=parseInt(E.substring(A,A+I),m);I<8?(I=d(Math.pow(m,I)),T=T.j(I).add(d(g))):(T=T.j(_),T=T.add(d(g)))}return T}var y=h(0),w=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(O(this))return-C(this).m();let E=0,m=1;for(let _=0;_<this.g.length;_++){let T=this.i(_);E+=(T>=0?T:4294967296+T)*m,m*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(D(this))return"0";if(O(this))return"-"+C(this).toString(E);let m=d(Math.pow(E,6));var _=this;let T="";for(;;){let I=ye(_,m).g;_=j(_,I.j(m));let A=((_.g.length>0?_.g[0]:_.h)>>>0).toString(E);if(_=I,D(_))return A+T;for(;A.length<6;)A="0"+A;T=A+T}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function D(E){if(E.h!=0)return!1;for(let m=0;m<E.g.length;m++)if(E.g[m]!=0)return!1;return!0}function O(E){return E.h==-1}n.l=function(E){return E=j(this,E),O(E)?-1:D(E)?0:1};function C(E){let m=E.g.length,_=[];for(let T=0;T<m;T++)_[T]=~E.g[T];return new a(_,~E.h).add(w)}n.abs=function(){return O(this)?C(this):this},n.add=function(E){let m=Math.max(this.g.length,E.g.length),_=[],T=0;for(let I=0;I<=m;I++){let A=T+(this.i(I)&65535)+(E.i(I)&65535),g=(A>>>16)+(this.i(I)>>>16)+(E.i(I)>>>16);T=g>>>16,A&=65535,g&=65535,_[I]=g<<16|A}return new a(_,_[_.length-1]&-2147483648?-1:0)};function j(E,m){return E.add(C(m))}n.j=function(E){if(D(this)||D(E))return y;if(O(this))return O(E)?C(this).j(C(E)):C(C(this).j(E));if(O(E))return C(this.j(C(E)));if(this.l(R)<0&&E.l(R)<0)return d(this.m()*E.m());let m=this.g.length+E.g.length,_=[];for(var T=0;T<2*m;T++)_[T]=0;for(T=0;T<this.g.length;T++)for(let I=0;I<E.g.length;I++){let A=this.i(T)>>>16,g=this.i(T)&65535,Te=E.i(I)>>>16,lt=E.i(I)&65535;_[2*T+2*I]+=g*lt,W(_,2*T+2*I),_[2*T+2*I+1]+=A*lt,W(_,2*T+2*I+1),_[2*T+2*I+1]+=g*Te,W(_,2*T+2*I+1),_[2*T+2*I+2]+=A*Te,W(_,2*T+2*I+2)}for(E=0;E<m;E++)_[E]=_[2*E+1]<<16|_[2*E];for(E=m;E<2*m;E++)_[E]=0;return new a(_,0)};function W(E,m){for(;(E[m]&65535)!=E[m];)E[m+1]+=E[m]>>>16,E[m]&=65535,m++}function H(E,m){this.g=E,this.h=m}function ye(E,m){if(D(m))throw Error("division by zero");if(D(E))return new H(y,y);if(O(E))return m=ye(C(E),m),new H(C(m.g),C(m.h));if(O(m))return m=ye(E,C(m)),new H(C(m.g),m.h);if(E.g.length>30){if(O(E)||O(m))throw Error("slowDivide_ only works with positive integers.");for(var _=w,T=m;T.l(E)<=0;)_=Ee(_),T=Ee(T);var I=le(_,1),A=le(T,1);for(T=le(T,2),_=le(_,2);!D(T);){var g=A.add(T);g.l(E)<=0&&(I=I.add(_),A=g),T=le(T,1),_=le(_,1)}return m=j(E,I.j(m)),new H(I,m)}for(I=y;E.l(m)>=0;){for(_=Math.max(1,Math.floor(E.m()/m.m())),T=Math.ceil(Math.log(_)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),A=d(_),g=A.j(m);O(g)||g.l(E)>0;)_-=T,A=d(_),g=A.j(m);D(A)&&(A=w),I=I.add(A),E=j(E,g)}return new H(I,E)}n.B=function(E){return ye(this,E).h},n.and=function(E){let m=Math.max(this.g.length,E.g.length),_=[];for(let T=0;T<m;T++)_[T]=this.i(T)&E.i(T);return new a(_,this.h&E.h)},n.or=function(E){let m=Math.max(this.g.length,E.g.length),_=[];for(let T=0;T<m;T++)_[T]=this.i(T)|E.i(T);return new a(_,this.h|E.h)},n.xor=function(E){let m=Math.max(this.g.length,E.g.length),_=[];for(let T=0;T<m;T++)_[T]=this.i(T)^E.i(T);return new a(_,this.h^E.h)};function Ee(E){let m=E.g.length+1,_=[];for(let T=0;T<m;T++)_[T]=E.i(T)<<1|E.i(T-1)>>>31;return new a(_,E.h)}function le(E,m){let _=m>>5;m%=32;let T=E.g.length-_,I=[];for(let A=0;A<T;A++)I[A]=m>0?E.i(A+_)>>>m|E.i(A+_+1)<<32-m:E.i(A+_);return new a(I,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Uo=vh.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,Xe=vh.Integer=a}).apply(typeof Th<"u"?Th:typeof self<"u"?self:typeof window<"u"?window:{});var Ii=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ze={};var Bo,qg,dn,qo,lr,wi,jo,zo,Go;(function(){var n,e=Object.defineProperty;function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ii=="object"&&Ii];for(var c=0;c<s.length;++c){var l=s[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function i(s,c){if(c)e:{var l=r;s=s.split(".");for(var f=0;f<s.length-1;f++){var v=s[f];if(!(v in l))break e;l=l[v]}s=s[s.length-1],f=l[s],c=c(f),c!=f&&c!=null&&e(l,s,{configurable:!0,writable:!0,value:c})}}i("Symbol.dispose",function(s){return s||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(s){return s||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(s){return s||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(s){var c=typeof s;return c=="object"&&s!=null||c=="function"}function h(s,c,l){return s.call.apply(s.bind,arguments)}function d(s,c,l){return d=h,d.apply(null,arguments)}function p(s,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),s.apply(this,f)}}function y(s,c){function l(){}l.prototype=c.prototype,s.Z=c.prototype,s.prototype=new l,s.prototype.constructor=s,s.Ob=function(f,v,b){for(var k=Array(arguments.length-2),B=2;B<arguments.length;B++)k[B-2]=arguments[B];return c.prototype[v].apply(f,k)}}var w=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?s=>s&&AsyncContext.Snapshot.wrap(s):s=>s;function R(s){let c=s.length;if(c>0){let l=Array(c);for(let f=0;f<c;f++)l[f]=s[f];return l}return[]}function D(s,c){for(let f=1;f<arguments.length;f++){let v=arguments[f];var l=typeof v;if(l=l!="object"?l:v?Array.isArray(v)?"array":l:"null",l=="array"||l=="object"&&typeof v.length=="number"){l=s.length||0;let b=v.length||0;s.length=l+b;for(let k=0;k<b;k++)s[l+k]=v[k]}else s.push(v)}}class O{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function C(s){a.setTimeout(()=>{throw s},0)}function j(){var s=E;let c=null;return s.g&&(c=s.g,s.g=s.g.next,s.g||(s.h=null),c.next=null),c}class W{constructor(){this.h=this.g=null}add(c,l){let f=H.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var H=new O(()=>new ye,s=>s.reset());class ye{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let Ee,le=!1,E=new W,m=()=>{let s=Promise.resolve(void 0);Ee=()=>{s.then(_)}};function _(){for(var s;s=j();){try{s.h.call(s.g)}catch(l){C(l)}var c=H;c.j(s),c.h<100&&(c.h++,s.next=c.g,c.g=s)}le=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(s,c){this.type=s,this.g=this.target=c,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var s=!1,c=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return s})();function g(s){return/^[\s\xa0]*$/.test(s)}function Te(s,c){I.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s&&this.init(s,c)}y(Te,I),Te.prototype.init=function(s,c){let l=this.type=s.type,f=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;this.target=s.target||s.srcElement,this.g=c,c=s.relatedTarget,c||(l=="mouseover"?c=s.fromElement:l=="mouseout"&&(c=s.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=s.pointerType,this.state=s.state,this.i=s,s.defaultPrevented&&Te.Z.h.call(this)},Te.prototype.h=function(){Te.Z.h.call(this);let s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var lt="closure_listenable_"+(Math.random()*1e6|0),Jp=0;function Yp(s,c,l,f,v){this.listener=s,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=v,this.key=++Jp,this.da=this.fa=!1}function Gr(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function $r(s,c,l){for(let f in s)c.call(l,s[f],f,s)}function Xp(s,c){for(let l in s)c.call(void 0,s[l],l,s)}function qu(s){let c={};for(let l in s)c[l]=s[l];return c}let ju="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function zu(s,c){let l,f;for(let v=1;v<arguments.length;v++){f=arguments[v];for(l in f)s[l]=f[l];for(let b=0;b<ju.length;b++)l=ju[b],Object.prototype.hasOwnProperty.call(f,l)&&(s[l]=f[l])}}function Kr(s){this.src=s,this.g={},this.h=0}Kr.prototype.add=function(s,c,l,f,v){let b=s.toString();s=this.g[b],s||(s=this.g[b]=[],this.h++);let k=$s(s,c,f,v);return k>-1?(c=s[k],l||(c.fa=!1)):(c=new Yp(c,this.src,b,!!f,v),c.fa=l,s.push(c)),c};function Gs(s,c){let l=c.type;if(l in s.g){var f=s.g[l],v=Array.prototype.indexOf.call(f,c,void 0),b;(b=v>=0)&&Array.prototype.splice.call(f,v,1),b&&(Gr(c),s.g[l].length==0&&(delete s.g[l],s.h--))}}function $s(s,c,l,f){for(let v=0;v<s.length;++v){let b=s[v];if(!b.da&&b.listener==c&&b.capture==!!l&&b.ha==f)return v}return-1}var Ks="closure_lm_"+(Math.random()*1e6|0),Ws={};function Gu(s,c,l,f,v){if(f&&f.once)return Ku(s,c,l,f,v);if(Array.isArray(c)){for(let b=0;b<c.length;b++)Gu(s,c[b],l,f,v);return null}return l=Ys(l),s&&s[lt]?s.J(c,l,u(f)?!!f.capture:!!f,v):$u(s,c,l,!1,f,v)}function $u(s,c,l,f,v,b){if(!c)throw Error("Invalid event type");let k=u(v)?!!v.capture:!!v,B=Qs(s);if(B||(s[Ks]=B=new Kr(s)),l=B.add(c,l,f,k,b),l.proxy)return l;if(f=Zp(),l.proxy=f,f.src=s,f.listener=l,s.addEventListener)A||(v=k),v===void 0&&(v=!1),s.addEventListener(c.toString(),f,v);else if(s.attachEvent)s.attachEvent(Hu(c.toString()),f);else if(s.addListener&&s.removeListener)s.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function Zp(){function s(l){return c.call(s.src,s.listener,l)}let c=em;return s}function Ku(s,c,l,f,v){if(Array.isArray(c)){for(let b=0;b<c.length;b++)Ku(s,c[b],l,f,v);return null}return l=Ys(l),s&&s[lt]?s.K(c,l,u(f)?!!f.capture:!!f,v):$u(s,c,l,!0,f,v)}function Wu(s,c,l,f,v){if(Array.isArray(c))for(var b=0;b<c.length;b++)Wu(s,c[b],l,f,v);else f=u(f)?!!f.capture:!!f,l=Ys(l),s&&s[lt]?(s=s.i,b=String(c).toString(),b in s.g&&(c=s.g[b],l=$s(c,l,f,v),l>-1&&(Gr(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete s.g[b],s.h--)))):s&&(s=Qs(s))&&(c=s.g[c.toString()],s=-1,c&&(s=$s(c,l,f,v)),(l=s>-1?c[s]:null)&&Hs(l))}function Hs(s){if(typeof s!="number"&&s&&!s.da){var c=s.src;if(c&&c[lt])Gs(c.i,s);else{var l=s.type,f=s.proxy;c.removeEventListener?c.removeEventListener(l,f,s.capture):c.detachEvent?c.detachEvent(Hu(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=Qs(c))?(Gs(l,s),l.h==0&&(l.src=null,c[Ks]=null)):Gr(s)}}}function Hu(s){return s in Ws?Ws[s]:Ws[s]="on"+s}function em(s,c){if(s.da)s=!0;else{c=new Te(c,this);let l=s.listener,f=s.ha||s.src;s.fa&&Hs(s),s=l.call(f,c)}return s}function Qs(s){return s=s[Ks],s instanceof Kr?s:null}var Js="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ys(s){return typeof s=="function"?s:(s[Js]||(s[Js]=function(c){return s.handleEvent(c)}),s[Js])}function me(){T.call(this),this.i=new Kr(this),this.M=this,this.G=null}y(me,T),me.prototype[lt]=!0,me.prototype.removeEventListener=function(s,c,l,f){Wu(this,s,c,l,f)};function Ie(s,c){var l,f=s.G;if(f)for(l=[];f;f=f.G)l.push(f);if(s=s.M,f=c.type||c,typeof c=="string")c=new I(c,s);else if(c instanceof I)c.target=c.target||s;else{var v=c;c=new I(f,s),zu(c,v)}v=!0;let b,k;if(l)for(k=l.length-1;k>=0;k--)b=c.g=l[k],v=Wr(b,f,!0,c)&&v;if(b=c.g=s,v=Wr(b,f,!0,c)&&v,v=Wr(b,f,!1,c)&&v,l)for(k=0;k<l.length;k++)b=c.g=l[k],v=Wr(b,f,!1,c)&&v}me.prototype.N=function(){if(me.Z.N.call(this),this.i){var s=this.i;for(let c in s.g){let l=s.g[c];for(let f=0;f<l.length;f++)Gr(l[f]);delete s.g[c],s.h--}}this.G=null},me.prototype.J=function(s,c,l,f){return this.i.add(String(s),c,!1,l,f)},me.prototype.K=function(s,c,l,f){return this.i.add(String(s),c,!0,l,f)};function Wr(s,c,l,f){if(c=s.i.g[String(c)],!c)return!0;c=c.concat();let v=!0;for(let b=0;b<c.length;++b){let k=c[b];if(k&&!k.da&&k.capture==l){let B=k.listener,ce=k.ha||k.src;k.fa&&Gs(s.i,k),v=B.call(ce,f)!==!1&&v}}return v&&!f.defaultPrevented}function tm(s,c){if(typeof s!="function")if(s&&typeof s.handleEvent=="function")s=d(s.handleEvent,s);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(s,c||0)}function Qu(s){s.g=tm(()=>{s.g=null,s.i&&(s.i=!1,Qu(s))},s.l);let c=s.h;s.h=null,s.m.apply(null,c)}class nm extends T{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Qu(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Bn(s){T.call(this),this.h=s,this.g={}}y(Bn,T);var Ju=[];function Yu(s){$r(s.g,function(c,l){this.g.hasOwnProperty(l)&&Hs(c)},s),s.g={}}Bn.prototype.N=function(){Bn.Z.N.call(this),Yu(this)},Bn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Xs=a.JSON.stringify,rm=a.JSON.parse,im=class{stringify(s){return a.JSON.stringify(s,void 0)}parse(s){return a.JSON.parse(s,void 0)}};function Xu(){}function Zu(){}var qn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Zs(){I.call(this,"d")}y(Zs,I);function eo(){I.call(this,"c")}y(eo,I);var Lt={},el=null;function Hr(){return el=el||new me}Lt.Ia="serverreachability";function tl(s){I.call(this,Lt.Ia,s)}y(tl,I);function jn(s){let c=Hr();Ie(c,new tl(c))}Lt.STAT_EVENT="statevent";function nl(s,c){I.call(this,Lt.STAT_EVENT,s),this.stat=c}y(nl,I);function we(s){let c=Hr();Ie(c,new nl(c,s))}Lt.Ja="timingevent";function rl(s,c){I.call(this,Lt.Ja,s),this.size=c}y(rl,I);function zn(s,c){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){s()},c)}function Gn(){this.g=!0}Gn.prototype.ua=function(){this.g=!1};function sm(s,c,l,f,v,b){s.info(function(){if(s.g)if(b){var k="",B=b.split("&");for(let J=0;J<B.length;J++){var ce=B[J].split("=");if(ce.length>1){let he=ce[0];ce=ce[1];let Fe=he.split("_");k=Fe.length>=2&&Fe[1]=="type"?k+(he+"="+ce+"&"):k+(he+"=redacted&")}}}else k=null;else k=b;return"XMLHTTP REQ ("+f+") [attempt "+v+"]: "+c+`
`+l+`
`+k})}function om(s,c,l,f,v,b,k){s.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+v+"]: "+c+`
`+l+`
`+b+" "+k})}function on(s,c,l,f){s.info(function(){return"XMLHTTP TEXT ("+c+"): "+cm(s,l)+(f?" "+f:"")})}function am(s,c){s.info(function(){return"TIMEOUT: "+c})}Gn.prototype.info=function(){};function cm(s,c){if(!s.g)return c;if(!c)return null;try{let b=JSON.parse(c);if(b){for(s=0;s<b.length;s++)if(Array.isArray(b[s])){var l=b[s];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var v=f[0];if(v!="noop"&&v!="stop"&&v!="close")for(let k=1;k<f.length;k++)f[k]=""}}}}return Xs(b)}catch{return c}}var Qr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},il={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},sl;function to(){}y(to,Xu),to.prototype.g=function(){return new XMLHttpRequest},sl=new to;function $n(s){return encodeURIComponent(String(s))}function um(s){var c=1;s=s.split(":");let l=[];for(;c>0&&s.length;)l.push(s.shift()),c--;return s.length&&l.push(s.join(":")),l}function ht(s,c,l,f){this.j=s,this.i=c,this.l=l,this.S=f||1,this.V=new Bn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ol}function ol(){this.i=null,this.g="",this.h=!1}var al={},no={};function ro(s,c,l){s.M=1,s.A=Yr(Me(c)),s.u=l,s.R=!0,cl(s,null)}function cl(s,c){s.F=Date.now(),Jr(s),s.B=Me(s.A);var l=s.B,f=s.S;Array.isArray(f)||(f=[String(f)]),El(l.i,"t",f),s.C=0,l=s.j.L,s.h=new ol,s.g=Ul(s.j,l?c:null,!s.u),s.P>0&&(s.O=new nm(d(s.Y,s,s.g),s.P)),c=s.V,l=s.g,f=s.ba;var v="readystatechange";Array.isArray(v)||(v&&(Ju[0]=v.toString()),v=Ju);for(let b=0;b<v.length;b++){let k=Gu(l,v[b],f||c.handleEvent,!1,c.h||c);if(!k)break;c.g[k.key]=k}c=s.J?qu(s.J):{},s.u?(s.v||(s.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.B,s.v,s.u,c)):(s.v="GET",s.g.ea(s.B,s.v,null,c)),jn(),sm(s.i,s.v,s.B,s.l,s.S,s.u)}ht.prototype.ba=function(s){s=s.target;let c=this.O;c&&pt(s)==3?c.j():this.Y(s)},ht.prototype.Y=function(s){try{if(s==this.g)e:{let B=pt(this.g),ce=this.g.ya(),J=this.g.ca();if(!(B<3)&&(B!=3||this.g&&(this.h.h||this.g.la()||Pl(this.g)))){this.K||B!=4||ce==7||(ce==8||J<=0?jn(3):jn(2)),io(this);var c=this.g.ca();this.X=c;var l=lm(this);if(this.o=c==200,om(this.i,this.v,this.B,this.l,this.S,B,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,v=this.g;if((f=v.g?v.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var b=f;break t}}b=null}if(s=b)on(this.i,this.l,s,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,so(this,s);else{this.o=!1,this.m=3,we(12),Mt(this),Kn(this);break e}}if(this.R){s=!0;let he;for(;!this.K&&this.C<l.length;)if(he=hm(this,l),he==no){B==4&&(this.m=4,we(14),s=!1),on(this.i,this.l,null,"[Incomplete Response]");break}else if(he==al){this.m=4,we(15),on(this.i,this.l,l,"[Invalid Chunk]"),s=!1;break}else on(this.i,this.l,he,null),so(this,he);if(ul(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),B!=4||l.length!=0||this.h.h||(this.m=1,we(16),s=!1),this.o=this.o&&s,!s)on(this.i,this.l,l,"[Invalid Chunked Response]"),Mt(this),Kn(this);else if(l.length>0&&!this.W){this.W=!0;var k=this.j;k.g==this&&k.aa&&!k.P&&(k.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),fo(k),k.P=!0,we(11))}}else on(this.i,this.l,l,null),so(this,l);B==4&&Mt(this),this.o&&!this.K&&(B==4?xl(this.j,this):(this.o=!1,Jr(this)))}else bm(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,we(12)):(this.m=0,we(13)),Mt(this),Kn(this)}}}catch{}finally{}};function lm(s){if(!ul(s))return s.g.la();let c=Pl(s.g);if(c==="")return"";let l="",f=c.length,v=pt(s.g)==4;if(!s.h.i){if(typeof TextDecoder>"u")return Mt(s),Kn(s),"";s.h.i=new a.TextDecoder}for(let b=0;b<f;b++)s.h.h=!0,l+=s.h.i.decode(c[b],{stream:!(v&&b==f-1)});return c.length=0,s.h.g+=l,s.C=0,s.h.g}function ul(s){return s.g?s.v=="GET"&&s.M!=2&&s.j.Aa:!1}function hm(s,c){var l=s.C,f=c.indexOf(`
`,l);return f==-1?no:(l=Number(c.substring(l,f)),isNaN(l)?al:(f+=1,f+l>c.length?no:(c=c.slice(f,f+l),s.C=f+l,c)))}ht.prototype.cancel=function(){this.K=!0,Mt(this)};function Jr(s){s.T=Date.now()+s.H,ll(s,s.H)}function ll(s,c){if(s.D!=null)throw Error("WatchDog timer not null");s.D=zn(d(s.aa,s),c)}function io(s){s.D&&(a.clearTimeout(s.D),s.D=null)}ht.prototype.aa=function(){this.D=null;let s=Date.now();s-this.T>=0?(am(this.i,this.B),this.M!=2&&(jn(),we(17)),Mt(this),this.m=2,Kn(this)):ll(this,this.T-s)};function Kn(s){s.j.I==0||s.K||xl(s.j,s)}function Mt(s){io(s);var c=s.O;c&&typeof c.dispose=="function"&&c.dispose(),s.O=null,Yu(s.V),s.g&&(c=s.g,s.g=null,c.abort(),c.dispose())}function so(s,c){try{var l=s.j;if(l.I!=0&&(l.g==s||oo(l.h,s))){if(!s.L&&oo(l.h,s)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var v=f;if(v[0]==0){e:if(!l.v){if(l.g)if(l.g.F+3e3<s.F)ri(l),ti(l);else break e;ho(l),we(18)}}else l.xa=v[1],0<l.xa-l.K&&v[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=zn(d(l.Va,l),6e3));fl(l.h)<=1&&l.ta&&(l.ta=void 0)}else Ut(l,11)}else if((s.L||l.g==s)&&ri(l),!g(c))for(v=l.Ba.g.parse(c),c=0;c<v.length;c++){let J=v[c],he=J[0];if(!(he<=l.K))if(l.K=he,J=J[1],l.I==2)if(J[0]=="c"){l.M=J[1],l.ba=J[2];let Fe=J[3];Fe!=null&&(l.ka=Fe,l.j.info("VER="+l.ka));let Bt=J[4];Bt!=null&&(l.za=Bt,l.j.info("SVER="+l.za));let mt=J[5];mt!=null&&typeof mt=="number"&&mt>0&&(f=1.5*mt,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;let gt=s.g;if(gt){let si=gt.g?gt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(si){var b=f.h;b.g||si.indexOf("spdy")==-1&&si.indexOf("quic")==-1&&si.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(ao(b,b.h),b.h=null))}if(f.G){let po=gt.g?gt.g.getResponseHeader("X-HTTP-Session-Id"):null;po&&(f.wa=po,Y(f.J,f.G,po))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-s.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var k=s;if(f.na=Fl(f,f.L?f.ba:null,f.W),k.L){pl(f.h,k);var B=k,ce=f.O;ce&&(B.H=ce),B.D&&(io(B),Jr(B)),f.g=k}else Ol(f);l.i.length>0&&ni(l)}else J[0]!="stop"&&J[0]!="close"||Ut(l,7);else l.I==3&&(J[0]=="stop"||J[0]=="close"?J[0]=="stop"?Ut(l,7):lo(l):J[0]!="noop"&&l.l&&l.l.qa(J),l.A=0)}}jn(4)}catch{}}var dm=class{constructor(s,c){this.g=s,this.map=c}};function hl(s){this.l=s||10,a.PerformanceNavigationTiming?(s=a.performance.getEntriesByType("navigation"),s=s.length>0&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function dl(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function fl(s){return s.h?1:s.g?s.g.size:0}function oo(s,c){return s.h?s.h==c:s.g?s.g.has(c):!1}function ao(s,c){s.g?s.g.add(c):s.h=c}function pl(s,c){s.h&&s.h==c?s.h=null:s.g&&s.g.has(c)&&s.g.delete(c)}hl.prototype.cancel=function(){if(this.i=ml(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function ml(s){if(s.h!=null)return s.i.concat(s.h.G);if(s.g!=null&&s.g.size!==0){let c=s.i;for(let l of s.g.values())c=c.concat(l.G);return c}return R(s.i)}var gl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function fm(s,c){if(s){s=s.split("&");for(let l=0;l<s.length;l++){let f=s[l].indexOf("="),v,b=null;f>=0?(v=s[l].substring(0,f),b=s[l].substring(f+1)):v=s[l],c(v,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function dt(s){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;s instanceof dt?(this.l=s.l,Wn(this,s.j),this.o=s.o,this.g=s.g,Hn(this,s.u),this.h=s.h,co(this,Tl(s.i)),this.m=s.m):s&&(c=String(s).match(gl))?(this.l=!1,Wn(this,c[1]||"",!0),this.o=Qn(c[2]||""),this.g=Qn(c[3]||"",!0),Hn(this,c[4]),this.h=Qn(c[5]||"",!0),co(this,c[6]||"",!0),this.m=Qn(c[7]||"")):(this.l=!1,this.i=new Yn(null,this.l))}dt.prototype.toString=function(){let s=[];var c=this.j;c&&s.push(Jn(c,_l,!0),":");var l=this.g;return(l||c=="file")&&(s.push("//"),(c=this.o)&&s.push(Jn(c,_l,!0),"@"),s.push($n(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&s.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&s.push("/"),s.push(Jn(l,l.charAt(0)=="/"?gm:mm,!0))),(l=this.i.toString())&&s.push("?",l),(l=this.m)&&s.push("#",Jn(l,ym)),s.join("")},dt.prototype.resolve=function(s){let c=Me(this),l=!!s.j;l?Wn(c,s.j):l=!!s.o,l?c.o=s.o:l=!!s.g,l?c.g=s.g:l=s.u!=null;var f=s.h;if(l)Hn(c,s.u);else if(l=!!s.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var v=c.h.lastIndexOf("/");v!=-1&&(f=c.h.slice(0,v+1)+f)}if(v=f,v==".."||v==".")f="";else if(v.indexOf("./")!=-1||v.indexOf("/.")!=-1){f=v.lastIndexOf("/",0)==0,v=v.split("/");let b=[];for(let k=0;k<v.length;){let B=v[k++];B=="."?f&&k==v.length&&b.push(""):B==".."?((b.length>1||b.length==1&&b[0]!="")&&b.pop(),f&&k==v.length&&b.push("")):(b.push(B),f=!0)}f=b.join("/")}else f=v}return l?c.h=f:l=s.i.toString()!=="",l?co(c,Tl(s.i)):l=!!s.m,l&&(c.m=s.m),c};function Me(s){return new dt(s)}function Wn(s,c,l){s.j=l?Qn(c,!0):c,s.j&&(s.j=s.j.replace(/:$/,""))}function Hn(s,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);s.u=c}else s.u=null}function co(s,c,l){c instanceof Yn?(s.i=c,Im(s.i,s.l)):(l||(c=Jn(c,_m)),s.i=new Yn(c,s.l))}function Y(s,c,l){s.i.set(c,l)}function Yr(s){return Y(s,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),s}function Qn(s,c){return s?c?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function Jn(s,c,l){return typeof s=="string"?(s=encodeURI(s).replace(c,pm),l&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function pm(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var _l=/[#\/\?@]/g,mm=/[#\?:]/g,gm=/[#\?]/g,_m=/[#\?@]/g,ym=/#/g;function Yn(s,c){this.h=this.g=null,this.i=s||null,this.j=!!c}function Ft(s){s.g||(s.g=new Map,s.h=0,s.i&&fm(s.i,function(c,l){s.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=Yn.prototype,n.add=function(s,c){Ft(this),this.i=null,s=an(this,s);let l=this.g.get(s);return l||this.g.set(s,l=[]),l.push(c),this.h+=1,this};function yl(s,c){Ft(s),c=an(s,c),s.g.has(c)&&(s.i=null,s.h-=s.g.get(c).length,s.g.delete(c))}function Il(s,c){return Ft(s),c=an(s,c),s.g.has(c)}n.forEach=function(s,c){Ft(this),this.g.forEach(function(l,f){l.forEach(function(v){s.call(c,v,f,this)},this)},this)};function wl(s,c){Ft(s);let l=[];if(typeof c=="string")Il(s,c)&&(l=l.concat(s.g.get(an(s,c))));else for(s=Array.from(s.g.values()),c=0;c<s.length;c++)l=l.concat(s[c]);return l}n.set=function(s,c){return Ft(this),this.i=null,s=an(this,s),Il(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[c]),this.h+=1,this},n.get=function(s,c){return s?(s=wl(this,s),s.length>0?String(s[0]):c):c};function El(s,c,l){yl(s,c),l.length>0&&(s.i=null,s.g.set(an(s,c),R(l)),s.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];let v=$n(l);l=wl(this,l);for(let b=0;b<l.length;b++){let k=v;l[b]!==""&&(k+="="+$n(l[b])),s.push(k)}}return this.i=s.join("&")};function Tl(s){let c=new Yn;return c.i=s.i,s.g&&(c.g=new Map(s.g),c.h=s.h),c}function an(s,c){return c=String(c),s.j&&(c=c.toLowerCase()),c}function Im(s,c){c&&!s.j&&(Ft(s),s.i=null,s.g.forEach(function(l,f){let v=f.toLowerCase();f!=v&&(yl(this,f),El(this,v,l))},s)),s.j=c}function wm(s,c){let l=new Gn;if(a.Image){let f=new Image;f.onload=p(ft,l,"TestLoadImage: loaded",!0,c,f),f.onerror=p(ft,l,"TestLoadImage: error",!1,c,f),f.onabort=p(ft,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(ft,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=s}else c(!1)}function Em(s,c){let l=new Gn,f=new AbortController,v=setTimeout(()=>{f.abort(),ft(l,"TestPingServer: timeout",!1,c)},1e4);fetch(s,{signal:f.signal}).then(b=>{clearTimeout(v),b.ok?ft(l,"TestPingServer: ok",!0,c):ft(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(v),ft(l,"TestPingServer: error",!1,c)})}function ft(s,c,l,f,v){try{v&&(v.onload=null,v.onerror=null,v.onabort=null,v.ontimeout=null),f(l)}catch{}}function Tm(){this.g=new im}function Xr(s){this.i=s.Sb||null,this.h=s.ab||!1}y(Xr,Xu),Xr.prototype.g=function(){return new Zr(this.i,this.h)};function Zr(s,c){me.call(this),this.H=s,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}y(Zr,me),n=Zr.prototype,n.open=function(s,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=s,this.D=c,this.readyState=1,Zn(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};s&&(c.body=s),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Xn(this)),this.readyState=0},n.Pa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,Zn(this)),this.g&&(this.readyState=3,Zn(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;vl(this)}else s.text().then(this.Oa.bind(this),this.ga.bind(this))};function vl(s){s.j.read().then(s.Ma.bind(s)).catch(s.ga.bind(s))}n.Ma=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var c=s.value?s.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!s.done}))&&(this.response=this.responseText+=c)}s.done?Xn(this):Zn(this),this.readyState==3&&vl(this)}},n.Oa=function(s){this.g&&(this.response=this.responseText=s,Xn(this))},n.Na=function(s){this.g&&(this.response=s,Xn(this))},n.ga=function(){this.g&&Xn(this)};function Xn(s){s.readyState=4,s.l=null,s.j=null,s.B=null,Zn(s)}n.setRequestHeader=function(s,c){this.A.append(s,c)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,s.push(l[0]+": "+l[1]),l=c.next();return s.join(`\r
`)};function Zn(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(Zr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function Al(s){let c="";return $r(s,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function uo(s,c,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=Al(l),typeof s=="string"?l!=null&&$n(l):Y(s,c,l))}function te(s){me.call(this),this.headers=new Map,this.L=s||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}y(te,me);var vm=/^https?$/i,Am=["POST","PUT"];n=te.prototype,n.Fa=function(s){this.H=s},n.ea=function(s,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);c=c?c.toUpperCase():"GET",this.D=s,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():sl.g(),this.g.onreadystatechange=w(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(s),!0),this.B=!1}catch(b){bl(this,b);return}if(s=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var v in f)l.set(v,f[v]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let b of f.keys())l.set(b,f.get(b));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(b=>b.toLowerCase()=="content-type"),v=a.FormData&&s instanceof a.FormData,!(Array.prototype.indexOf.call(Am,c,void 0)>=0)||f||v||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[b,k]of l)this.g.setRequestHeader(b,k);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(s),this.v=!1}catch(b){bl(this,b)}};function bl(s,c){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=c,s.o=5,Sl(s),ei(s)}function Sl(s){s.A||(s.A=!0,Ie(s,"complete"),Ie(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=s||7,Ie(this,"complete"),Ie(this,"abort"),ei(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ei(this,!0)),te.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Rl(this):this.Xa())},n.Xa=function(){Rl(this)};function Rl(s){if(s.h&&typeof o<"u"){if(s.v&&pt(s)==4)setTimeout(s.Ca.bind(s),0);else if(Ie(s,"readystatechange"),pt(s)==4){s.h=!1;try{let b=s.ca();e:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var f;if(f=b===0){let k=String(s.D).match(gl)[1]||null;!k&&a.self&&a.self.location&&(k=a.self.location.protocol.slice(0,-1)),f=!vm.test(k?k.toLowerCase():"")}l=f}if(l)Ie(s,"complete"),Ie(s,"success");else{s.o=6;try{var v=pt(s)>2?s.g.statusText:""}catch{v=""}s.l=v+" ["+s.ca()+"]",Sl(s)}}finally{ei(s)}}}}function ei(s,c){if(s.g){s.m&&(clearTimeout(s.m),s.m=null);let l=s.g;s.g=null,c||Ie(s,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function pt(s){return s.g?s.g.readyState:0}n.ca=function(){try{return pt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(s){if(this.g){var c=this.g.responseText;return s&&c.indexOf(s)==0&&(c=c.substring(s.length)),rm(c)}};function Pl(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.F){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function bm(s){let c={};s=(s.g&&pt(s)>=2&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<s.length;f++){if(g(s[f]))continue;var l=um(s[f]);let v=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();let b=c[v]||[];c[v]=b,b.push(l)}Xp(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function er(s,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[s]||c}function Cl(s){this.za=0,this.i=[],this.j=new Gn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=er("failFast",!1,s),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=er("baseRetryDelayMs",5e3,s),this.Za=er("retryDelaySeedMs",1e4,s),this.Ta=er("forwardChannelMaxRetries",2,s),this.va=er("forwardChannelRequestTimeoutMs",2e4,s),this.ma=s&&s.xmlHttpFactory||void 0,this.Ua=s&&s.Rb||void 0,this.Aa=s&&s.useFetchStreams||!1,this.O=void 0,this.L=s&&s.supportsCrossDomainXhr||!1,this.M="",this.h=new hl(s&&s.concurrentRequestLimit),this.Ba=new Tm,this.S=s&&s.fastHandshake||!1,this.R=s&&s.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=s&&s.Pb||!1,s&&s.ua&&this.j.ua(),s&&s.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&s&&s.detectBufferingProxy||!1,this.ia=void 0,s&&s.longPollingTimeout&&s.longPollingTimeout>0&&(this.ia=s.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Cl.prototype,n.ka=8,n.I=1,n.connect=function(s,c,l,f){we(0),this.W=s,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=Fl(this,null,this.W),ni(this)};function lo(s){if(Nl(s),s.I==3){var c=s.V++,l=Me(s.J);if(Y(l,"SID",s.M),Y(l,"RID",c),Y(l,"TYPE","terminate"),tr(s,l),c=new ht(s,s.j,c),c.M=2,c.A=Yr(Me(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=Ul(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Jr(c)}Ml(s)}function ti(s){s.g&&(fo(s),s.g.cancel(),s.g=null)}function Nl(s){ti(s),s.v&&(a.clearTimeout(s.v),s.v=null),ri(s),s.h.cancel(),s.m&&(typeof s.m=="number"&&a.clearTimeout(s.m),s.m=null)}function ni(s){if(!dl(s.h)&&!s.m){s.m=!0;var c=s.Ea;Ee||m(),le||(Ee(),le=!0),E.add(c,s),s.D=0}}function Sm(s,c){return fl(s.h)>=s.h.j-(s.m?1:0)?!1:s.m?(s.i=c.G.concat(s.i),!0):s.I==1||s.I==2||s.D>=(s.Sa?0:s.Ta)?!1:(s.m=zn(d(s.Ea,s,c),Ll(s,s.D)),s.D++,!0)}n.Ea=function(s){if(this.m)if(this.m=null,this.I==1){if(!s){this.V=Math.floor(Math.random()*1e5),s=this.V++;let v=new ht(this,this.j,s),b=this.o;if(this.U&&(b?(b=qu(b),zu(b,this.U)):b=this.U),this.u!==null||this.R||(v.J=b,b=null),this.S)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=Dl(this,v,c),l=Me(this.J),Y(l,"RID",s),Y(l,"CVER",22),this.G&&Y(l,"X-HTTP-Session-Id",this.G),tr(this,l),b&&(this.R?c="headers="+$n(Al(b))+"&"+c:this.u&&uo(l,this.u,b)),ao(this.h,v),this.Ra&&Y(l,"TYPE","init"),this.S?(Y(l,"$req",c),Y(l,"SID","null"),v.U=!0,ro(v,l,null)):ro(v,l,c),this.I=2}}else this.I==3&&(s?kl(this,s):this.i.length==0||dl(this.h)||kl(this))};function kl(s,c){var l;c?l=c.l:l=s.V++;let f=Me(s.J);Y(f,"SID",s.M),Y(f,"RID",l),Y(f,"AID",s.K),tr(s,f),s.u&&s.o&&uo(f,s.u,s.o),l=new ht(s,s.j,l,s.D+1),s.u===null&&(l.J=s.o),c&&(s.i=c.G.concat(s.i)),c=Dl(s,l,1e3),l.H=Math.round(s.va*.5)+Math.round(s.va*.5*Math.random()),ao(s.h,l),ro(l,f,c)}function tr(s,c){s.H&&$r(s.H,function(l,f){Y(c,f,l)}),s.l&&$r({},function(l,f){Y(c,f,l)})}function Dl(s,c,l){l=Math.min(s.i.length,l);let f=s.l?d(s.l.Ka,s.l,s):null;e:{var v=s.i;let B=-1;for(;;){let ce=["count="+l];B==-1?l>0?(B=v[0].g,ce.push("ofs="+B)):B=0:ce.push("ofs="+B);let J=!0;for(let he=0;he<l;he++){var b=v[he].g;let Fe=v[he].map;if(b-=B,b<0)B=Math.max(0,v[he].g-100),J=!1;else try{b="req"+b+"_"||"";try{var k=Fe instanceof Map?Fe:Object.entries(Fe);for(let[Bt,mt]of k){let gt=mt;u(mt)&&(gt=Xs(mt)),ce.push(b+Bt+"="+encodeURIComponent(gt))}}catch(Bt){throw ce.push(b+"type="+encodeURIComponent("_badmap")),Bt}}catch{f&&f(Fe)}}if(J){k=ce.join("&");break e}}k=void 0}return s=s.i.splice(0,l),c.G=s,k}function Ol(s){if(!s.g&&!s.v){s.Y=1;var c=s.Da;Ee||m(),le||(Ee(),le=!0),E.add(c,s),s.A=0}}function ho(s){return s.g||s.v||s.A>=3?!1:(s.Y++,s.v=zn(d(s.Da,s),Ll(s,s.A)),s.A++,!0)}n.Da=function(){if(this.v=null,Vl(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var s=4*this.T;this.j.info("BP detection timer enabled: "+s),this.B=zn(d(this.Wa,this),s)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,we(10),ti(this),Vl(this))};function fo(s){s.B!=null&&(a.clearTimeout(s.B),s.B=null)}function Vl(s){s.g=new ht(s,s.j,"rpc",s.Y),s.u===null&&(s.g.J=s.o),s.g.P=0;var c=Me(s.na);Y(c,"RID","rpc"),Y(c,"SID",s.M),Y(c,"AID",s.K),Y(c,"CI",s.F?"0":"1"),!s.F&&s.ia&&Y(c,"TO",s.ia),Y(c,"TYPE","xmlhttp"),tr(s,c),s.u&&s.o&&uo(c,s.u,s.o),s.O&&(s.g.H=s.O);var l=s.g;s=s.ba,l.M=1,l.A=Yr(Me(c)),l.u=null,l.R=!0,cl(l,s)}n.Va=function(){this.C!=null&&(this.C=null,ti(this),ho(this),we(19))};function ri(s){s.C!=null&&(a.clearTimeout(s.C),s.C=null)}function xl(s,c){var l=null;if(s.g==c){ri(s),fo(s),s.g=null;var f=2}else if(oo(s.h,c))l=c.G,pl(s.h,c),f=1;else return;if(s.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var v=s.D;f=Hr(),Ie(f,new rl(f,l)),ni(s)}else Ol(s);else if(v=c.m,v==3||v==0&&c.X>0||!(f==1&&Sm(s,c)||f==2&&ho(s)))switch(l&&l.length>0&&(c=s.h,c.i=c.i.concat(l)),v){case 1:Ut(s,5);break;case 4:Ut(s,10);break;case 3:Ut(s,6);break;default:Ut(s,2)}}}function Ll(s,c){let l=s.Qa+Math.floor(Math.random()*s.Za);return s.isActive()||(l*=2),l*c}function Ut(s,c){if(s.j.info("Error code "+c),c==2){var l=d(s.bb,s),f=s.Ua;let v=!f;f=new dt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Wn(f,"https"),Yr(f),v?wm(f.toString(),l):Em(f.toString(),l)}else we(2);s.I=0,s.l&&s.l.pa(c),Ml(s),Nl(s)}n.bb=function(s){s?(this.j.info("Successfully pinged google.com"),we(2)):(this.j.info("Failed to ping google.com"),we(1))};function Ml(s){if(s.I=0,s.ja=[],s.l){let c=ml(s.h);(c.length!=0||s.i.length!=0)&&(D(s.ja,c),D(s.ja,s.i),s.h.i.length=0,R(s.i),s.i.length=0),s.l.oa()}}function Fl(s,c,l){var f=l instanceof dt?Me(l):new dt(l);if(f.g!="")c&&(f.g=c+"."+f.g),Hn(f,f.u);else{var v=a.location;f=v.protocol,c=c?c+"."+v.hostname:v.hostname,v=+v.port;let b=new dt(null);f&&Wn(b,f),c&&(b.g=c),v&&Hn(b,v),l&&(b.h=l),f=b}return l=s.G,c=s.wa,l&&c&&Y(f,l,c),Y(f,"VER",s.ka),tr(s,f),f}function Ul(s,c,l){if(c&&!s.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=s.Aa&&!s.ma?new te(new Xr({ab:l})):new te(s.ma),c.Fa(s.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Bl(){}n=Bl.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ii(){}ii.prototype.g=function(s,c){return new Ae(s,c)};function Ae(s,c){me.call(this),this.g=new Cl(c),this.l=s,this.h=c&&c.messageUrlParams||null,s=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(s?s["X-WebChannel-Content-Type"]=c.messageContentType:s={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(s?s["X-WebChannel-Client-Profile"]=c.sa:s={"X-WebChannel-Client-Profile":c.sa}),this.g.U=s,(s=c&&c.Qb)&&!g(s)&&(this.g.u=s),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,s=this.h,s!==null&&c in s&&(s=this.h,c in s&&delete s[c])),this.j=new cn(this)}y(Ae,me),Ae.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ae.prototype.close=function(){lo(this.g)},Ae.prototype.o=function(s){var c=this.g;if(typeof s=="string"){var l={};l.__data__=s,s=l}else this.v&&(l={},l.__data__=Xs(s),s=l);c.i.push(new dm(c.Ya++,s)),c.I==3&&ni(c)},Ae.prototype.N=function(){this.g.l=null,delete this.j,lo(this.g),delete this.g,Ae.Z.N.call(this)};function ql(s){Zs.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var c=s.__sm__;if(c){e:{for(let l in c){s=l;break e}s=void 0}(this.i=s)&&(s=this.i,c=c!==null&&s in c?c[s]:void 0),this.data=c}else this.data=s}y(ql,Zs);function jl(){eo.call(this),this.status=1}y(jl,eo);function cn(s){this.g=s}y(cn,Bl),cn.prototype.ra=function(){Ie(this.g,"a")},cn.prototype.qa=function(s){Ie(this.g,new ql(s))},cn.prototype.pa=function(s){Ie(this.g,new jl)},cn.prototype.oa=function(){Ie(this.g,"b")},ii.prototype.createWebChannel=ii.prototype.g,Ae.prototype.send=Ae.prototype.o,Ae.prototype.open=Ae.prototype.m,Ae.prototype.close=Ae.prototype.close,Go=Ze.createWebChannelTransport=function(){return new ii},zo=Ze.getStatEventTarget=function(){return Hr()},jo=Ze.Event=Lt,wi=Ze.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Qr.NO_ERROR=0,Qr.TIMEOUT=8,Qr.HTTP_ERROR=6,lr=Ze.ErrorCode=Qr,il.COMPLETE="complete",qo=Ze.EventType=il,Zu.EventType=qn,qn.OPEN="a",qn.CLOSE="b",qn.ERROR="c",qn.MESSAGE="d",me.prototype.listen=me.prototype.J,dn=Ze.WebChannel=Zu,qg=Ze.FetchXmlHttpFactory=Xr,te.prototype.listenOnce=te.prototype.K,te.prototype.getLastError=te.prototype.Ha,te.prototype.getLastErrorCode=te.prototype.ya,te.prototype.getStatus=te.prototype.ca,te.prototype.getResponseJson=te.prototype.La,te.prototype.getResponseText=te.prototype.la,te.prototype.send=te.prototype.ea,te.prototype.setWithCredentials=te.prototype.Fa,Bo=Ze.XhrIo=te}).apply(typeof Ii<"u"?Ii:typeof self<"u"?self:typeof window<"u"?window:{});var Ah="@firebase/firestore",bh="4.9.3";var fe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};fe.UNAUTHENTICATED=new fe(null),fe.GOOGLE_CREDENTIALS=new fe("google-credentials-uid"),fe.FIRST_PARTY=new fe("first-party-uid"),fe.MOCK_USER=new fe("mock-user");var Vn="12.7.0";var Wt=new yt("@firebase/firestore");function fn(){return Wt.logLevel}function V(n,...e){if(Wt.logLevel<=z.DEBUG){let t=e.map(Vc);Wt.debug(`Firestore (${Vn}): ${n}`,...t)}}function tt(n,...e){if(Wt.logLevel<=z.ERROR){let t=e.map(Vc);Wt.error(`Firestore (${Vn}): ${n}`,...t)}}function En(n,...e){if(Wt.logLevel<=z.WARN){let t=e.map(Vc);Wt.warn(`Firestore (${Vn}): ${n}`,...t)}}function Vc(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function L(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,pd(n,r,t)}function pd(n,e,t){let r=`FIRESTORE (${Vn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw tt(r),new Error(r)}function Q(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||pd(e,i,r)}function F(n,e){return n}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},N=class extends Se{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ve=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Ri=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Jo=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(fe.UNAUTHENTICATED))}shutdown(){}},Yo=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Xo=class{constructor(e){this.t=e,this.currentUser=fe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let r=this.i,i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve(),o=new Ve;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ve,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=o;e.enqueueRetryable(async()=>{await h.promise,await i(this.currentUser)})},u=h=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?u(h):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ve)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new Ri(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new fe(e)}},Zo=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=fe.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},ea=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Zo(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(fe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Pi=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},ta=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ve(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);let r=o=>{o.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.m;return this.m=o.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?i(o):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Pi(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Pi(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function jg(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var mr=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=jg(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}};function G(n,e){return n<e?-1:n>e?1:0}function na(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let i=n.charAt(r),o=e.charAt(r);if(i!==o)return $o(i)===$o(o)?G(i,o):$o(i)?1:-1}return G(n.length,e.length)}var zg=55296,Gg=57343;function $o(n){let e=n.charCodeAt(0);return e>=zg&&e<=Gg}function Tn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var Sh="__name__",Ci=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&L(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&L(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=n.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return G(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):na(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Xe.fromString(e.substring(4,e.length-2))}},X=class n extends Ci{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new N(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},$g=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Pe=class n extends Ci{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return $g.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Sh}static keyField(){return new n([Sh])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new N(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new N(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new N(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(o(),i++)}if(o(),a)throw new N(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var x=class n{constructor(e){this.path=e}static fromPath(e){return new n(X.fromString(e))}static fromName(e){return new n(X.fromString(e).popFirst(5))}static empty(){return new n(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&X.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new X(e.slice()))}};function md(n,e,t){if(!t)throw new N(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Kg(n,e,t,r){if(e===!0&&r===!0)throw new N(S.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Rh(n){if(!x.isDocumentKey(n))throw new N(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Ph(n){if(x.isDocumentKey(n))throw new N(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function gd(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function as(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":L(12329,{type:typeof n})}function Ce(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new N(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=as(n);throw new N(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Wg(n,e){if(e<=0)throw new N(S.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function ae(n,e){let t={typeString:n};return e&&(t.value=e),t}function kr(n,e){if(!gd(n))throw new N(S.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new N(S.INVALID_ARGUMENT,t);return!0}var Ch=-62135596800,Nh=1e6,ee=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Nh);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new N(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new N(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Ch)throw new N(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new N(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Nh}_compareTo(e){return this.seconds===e.seconds?G(this.nanoseconds,e.nanoseconds):G(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(kr(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-Ch;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};ee._jsonSchemaVersion="firestore/timestamp/1.0",ee._jsonSchema={type:ae("string",ee._jsonSchemaVersion),seconds:ae("number"),nanoseconds:ae("number")};var U=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new ee(0,0))}static max(){return new n(new ee(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var gr=-1,ra=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};ra.UNKNOWN_ID=-1;function Hg(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=U.fromTimestamp(r===1e9?new ee(t+1,0):new ee(t,r));return new Ht(i,x.empty(),e)}function Qg(n){return new Ht(n.readTime,n.key,gr)}var Ht=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(U.min(),x.empty(),gr)}static max(){return new n(U.max(),x.empty(),gr)}};function Jg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=x.comparator(n.documentKey,e.documentKey),t!==0?t:G(n.largestBatchId,e.largestBatchId))}var Yg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ia=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};async function xn(n){if(n.code!==S.FAILED_PRECONDITION||n.message!==Yg)throw n;V("LocalStore","Unexpectedly lost primary lease")}var P=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++o,a&&o===i&&t()},h=>r(h))}),a=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,a=new Array(o),u=0;for(let h=0;h<o;h++){let d=h;t(e[d]).next(p=>{a[d]=p,++u,u===o&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};function Xg(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Ln(n){return n.name==="IndexedDbTransactionError"}var xc=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>r.writeSequenceNumber(i))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ue&&this.ue(t),t}}n.ce=-1;return n})(),Lc=-1;function cs(n){return n==null}function _r(n){return n===0&&1/n==-1/0}function Zg(n){return typeof n=="number"&&Number.isInteger(n)&&!_r(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var _d="";function e_(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=kh(e)),e=t_(n.get(t),e);return kh(e)}function t_(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let o=n.charAt(i);switch(o){case"\0":t+="";break;case _d:t+="";break;default:t+=o}}return t}function kh(n){return n+_d+""}var n_="remoteDocuments",yd="owner";var Id="mutationQueues";var wd="mutations";var Ed="documentMutations",r_="remoteDocumentsV14";var Td="remoteDocumentGlobal";var vd="targets";var Ad="targetDocuments";var bd="targetGlobal",Sd="collectionParents";var Rd="clientMetadata";var Pd="bundles";var Cd="namedQueries";var i_="indexConfiguration";var s_="indexState";var o_="indexEntries";var Nd="documentOverlays";var a_="globals";var c_=[Id,wd,Ed,n_,vd,yd,bd,Ad,Rd,Td,Sd,Pd,Cd],vE=[...c_,Nd],u_=[Id,wd,Ed,r_,vd,yd,bd,Ad,Rd,Td,Sd,Pd,Cd,Nd],l_=u_,h_=[...l_,i_,s_,o_];var AE=[...h_,a_];function Dh(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Nt(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function kd(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var re=class n{constructor(e,t){this.comparator=e,this.root=t||qe.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qe.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _n(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _n(this.root,e,this.comparator,!1)}getReverseIterator(){return new _n(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _n(this.root,e,this.comparator,!0)}},_n=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},qe=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw L(27949);return e+(this.isRed()?0:1)}};qe.EMPTY=null,qe.RED=!0,qe.BLACK=!1;qe.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(e,t,r,i,o){return this}insert(e,t,r){return new qe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var pe=class n{constructor(e){this.comparator=e,this.data=new re(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ni(this.data.getIterator())}getIteratorFrom(e){return new Ni(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Ni=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var De=class n{constructor(e){this.fields=e,e.sort(Pe.comparator)}static empty(){return new n([])}unionWith(e){let t=new pe(Pe.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Tn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var ki=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var _e=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new ki("Invalid base64 string: "+o):o}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return G(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};_e.EMPTY_BYTE_STRING=new _e("");var d_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nt(n){if(Q(!!n,39018),typeof n=="string"){let e=0,t=d_.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Z(n.seconds),nanos:Z(n.nanos)}}function Z(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function rt(n){return typeof n=="string"?_e.fromBase64String(n):_e.fromUint8Array(n)}var Dd="server_timestamp",Od="__type__",Vd="__previous_value__",xd="__local_write_time__";function us(n){return(n?.mapValue?.fields||{})[Od]?.stringValue===Dd}function ls(n){let e=n.mapValue.fields[Vd];return us(e)?ls(e):e}function yr(n){let e=nt(n.mapValue.fields[xd].timestampValue);return new ee(e.seconds,e.nanos)}var sa=class{constructor(e,t,r,i,o,a,u,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}},Di="(default)",Oi=class n{constructor(e,t){this.projectId=e,this.database=t||Di}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Di}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Mc="__type__",Ld="__max__",Ei={mapValue:{fields:{__type__:{stringValue:Ld}}}},Fc="__vector__",vn="value";function St(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?us(n)?4:Fd(n)?9007199254740991:Md(n)?10:11:L(28295,{value:n})}function Ge(n,e){if(n===e)return!0;let t=St(n);if(t!==St(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return yr(n).isEqual(yr(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=nt(i.timestampValue),u=nt(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,o){return rt(i.bytesValue).isEqual(rt(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,o){return Z(i.geoPointValue.latitude)===Z(o.geoPointValue.latitude)&&Z(i.geoPointValue.longitude)===Z(o.geoPointValue.longitude)})(n,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return Z(i.integerValue)===Z(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=Z(i.doubleValue),u=Z(o.doubleValue);return a===u?_r(a)===_r(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return Tn(n.arrayValue.values||[],e.arrayValue.values||[],Ge);case 10:case 11:return(function(i,o){let a=i.mapValue.fields||{},u=o.mapValue.fields||{};if(Dh(a)!==Dh(u))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Ge(a[h],u[h])))return!1;return!0})(n,e);default:return L(52216,{left:n})}}function Ir(n,e){return(n.values||[]).find(t=>Ge(t,e))!==void 0}function An(n,e){if(n===e)return 0;let t=St(n),r=St(e);if(t!==r)return G(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return G(n.booleanValue,e.booleanValue);case 2:return(function(o,a){let u=Z(o.integerValue||o.doubleValue),h=Z(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,e);case 3:return Oh(n.timestampValue,e.timestampValue);case 4:return Oh(yr(n),yr(e));case 5:return na(n.stringValue,e.stringValue);case 6:return(function(o,a){let u=rt(o),h=rt(a);return u.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){let u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){let p=G(u[d],h[d]);if(p!==0)return p}return G(u.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){let u=G(Z(o.latitude),Z(a.latitude));return u!==0?u:G(Z(o.longitude),Z(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Vh(n.arrayValue,e.arrayValue);case 10:return(function(o,a){let u=o.fields||{},h=a.fields||{},d=u[vn]?.arrayValue,p=h[vn]?.arrayValue,y=G(d?.values?.length||0,p?.values?.length||0);return y!==0?y:Vh(d,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===Ei.mapValue&&a===Ei.mapValue)return 0;if(o===Ei.mapValue)return 1;if(a===Ei.mapValue)return-1;let u=o.fields||{},h=Object.keys(u),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let y=0;y<h.length&&y<p.length;++y){let w=na(h[y],p[y]);if(w!==0)return w;let R=An(u[h[y]],d[p[y]]);if(R!==0)return R}return G(h.length,p.length)})(n.mapValue,e.mapValue);default:throw L(23264,{he:t})}}function Oh(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return G(n,e);let t=nt(n),r=nt(e),i=G(t.seconds,r.seconds);return i!==0?i:G(t.nanos,r.nanos)}function Vh(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let o=An(t[i],r[i]);if(o)return o}return G(t.length,r.length)}function bn(n){return oa(n)}function oa(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=nt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return rt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return x.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=oa(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${oa(t.fields[a])}`;return i+"}"})(n.mapValue):L(61005,{value:n})}function Ai(n){switch(St(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=ls(n);return e?16+Ai(e):16;case 5:return 2*n.stringValue.length;case 6:return rt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,o)=>i+Ai(o),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return Nt(r.fields,(o,a)=>{i+=o.length+Ai(a)}),i})(n.mapValue);default:throw L(13486,{value:n})}}function Vi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function aa(n){return!!n&&"integerValue"in n}function Uc(n){return!!n&&"arrayValue"in n}function xh(n){return!!n&&"nullValue"in n}function Lh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function bi(n){return!!n&&"mapValue"in n}function Md(n){return(n?.mapValue?.fields||{})[Mc]?.stringValue===Fc}function dr(n){if(n.geoPointValue)return{geoPointValue:q({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:q({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Nt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=dr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=dr(n.arrayValue.values[t]);return e}return q({},n)}function Fd(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Ld}var SE={mapValue:{fields:{[Mc]:{stringValue:Fc},[vn]:{arrayValue:{}}}}};var Re=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!bi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=dr(t)}setAll(e){let t=Pe.emptyPath(),r={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=u.popLast()}a?r[u.lastSegment()]=dr(a):i.push(u.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());bi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ge(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];bi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Nt(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(dr(this.value))}};function Ud(n){let e=[];return Nt(n.fields,(t,r)=>{let i=new Pe([t]);if(bi(r)){let o=Ud(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new De(e)}var xe=class n{constructor(e,t,r,i,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new n(e,0,U.min(),U.min(),U.min(),Re.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,U.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,U.min(),U.min(),Re.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,U.min(),U.min(),Re.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Re.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Re.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Rt=class{constructor(e,t){this.position=e,this.inclusive=t}};function Mh(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],a=n.position[i];if(o.field.isKeyField()?r=x.comparator(x.fromName(a.referenceValue),t.key):r=An(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Fh(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ge(n.position[t],e.position[t]))return!1;return!0}var Qt=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function f_(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var xi=class{},oe=class n extends xi{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new ua(e,t,r):t==="array-contains"?new da(e,r):t==="in"?new fa(e,r):t==="not-in"?new pa(e,r):t==="array-contains-any"?new ma(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new la(e,r):new ha(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(An(t,this.value)):t!==null&&St(this.value)===St(t)&&this.matchesComparison(An(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Le=class n extends xi{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n(e,t)}matches(e){return Bd(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function Bd(n){return n.op==="and"}function qd(n){return p_(n)&&Bd(n)}function p_(n){for(let e of n.filters)if(e instanceof Le)return!1;return!0}function ca(n){if(n instanceof oe)return n.field.canonicalString()+n.op.toString()+bn(n.value);if(qd(n))return n.filters.map(e=>ca(e)).join(",");{let e=n.filters.map(t=>ca(t)).join(",");return`${n.op}(${e})`}}function jd(n,e){return n instanceof oe?(function(r,i){return i instanceof oe&&r.op===i.op&&r.field.isEqual(i.field)&&Ge(r.value,i.value)})(n,e):n instanceof Le?(function(r,i){return i instanceof Le&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,u)=>o&&jd(a,i.filters[u]),!0):!1})(n,e):void L(19439)}function zd(n){return n instanceof oe?(function(t){return`${t.field.canonicalString()} ${t.op} ${bn(t.value)}`})(n):n instanceof Le?(function(t){return t.op.toString()+" {"+t.getFilters().map(zd).join(" ,")+"}"})(n):"Filter"}var ua=class extends oe{constructor(e,t,r){super(e,t,r),this.key=x.fromName(r.referenceValue)}matches(e){let t=x.comparator(e.key,this.key);return this.matchesComparison(t)}},la=class extends oe{constructor(e,t){super(e,"in",t),this.keys=Gd("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},ha=class extends oe{constructor(e,t){super(e,"not-in",t),this.keys=Gd("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Gd(n,e){return(e.arrayValue?.values||[]).map(t=>x.fromName(t.referenceValue))}var da=class extends oe{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Uc(t)&&Ir(t.arrayValue,this.value)}},fa=class extends oe{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ir(this.value.arrayValue,t)}},pa=class extends oe{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ir(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ir(this.value.arrayValue,t)}},ma=class extends oe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Uc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ir(this.value.arrayValue,r))}};var ga=class{constructor(e,t=null,r=[],i=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}};function Uh(n,e=null,t=[],r=[],i=null,o=null,a=null){return new ga(n,e,t,r,i,o,a)}function Bc(n){let e=F(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>ca(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(o){return o.field.canonicalString()+o.dir})(r)).join(","),cs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>bn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>bn(r)).join(",")),e.Te=t}return e.Te}function qc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!f_(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!jd(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Fh(n.startAt,e.startAt)&&Fh(n.endAt,e.endAt)}function _a(n){return x.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var it=class{constructor(e,t=null,r=[],i=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function m_(n,e,t,r,i,o,a,u){return new it(n,e,t,r,i,o,a,u)}function hs(n){return new it(n)}function Bh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function jc(n){return n.collectionGroup!==null}function yn(n){let e=F(n);if(e.Ie===null){e.Ie=[];let t=new Set;for(let o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new pe(Pe.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Qt(o,r))}),t.has(Pe.keyField().canonicalString())||e.Ie.push(new Qt(Pe.keyField(),r))}return e.Ie}function je(n){let e=F(n);return e.Ee||(e.Ee=g_(e,yn(n))),e.Ee}function g_(n,e){if(n.limitType==="F")return Uh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new Qt(i.field,o)});let t=n.endAt?new Rt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Rt(n.startAt.position,n.startAt.inclusive):null;return Uh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ya(n,e){let t=n.filters.concat([e]);return new it(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Li(n,e,t){return new it(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ds(n,e){return qc(je(n),je(e))&&n.limitType===e.limitType}function $d(n){return`${Bc(je(n))}|lt:${n.limitType}`}function pn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>zd(i)).join(", ")}]`),cs(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>bn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>bn(i)).join(",")),`Target(${r})`})(je(n))}; limitType=${n.limitType})`}function fs(n,e){return e.isFoundDocument()&&(function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):x.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,i){for(let o of yn(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(a,u,h){let d=Mh(a,u,h);return a.inclusive?d<=0:d<0})(r.startAt,yn(r),i)||r.endAt&&!(function(a,u,h){let d=Mh(a,u,h);return a.inclusive?d>=0:d>0})(r.endAt,yn(r),i))})(n,e)}function __(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Kd(n){return(e,t)=>{let r=!1;for(let i of yn(n)){let o=y_(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function y_(n,e,t){let r=n.field.isKeyField()?x.comparator(e.key,t.key):(function(o,a,u){let h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?An(h,d):L(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return L(19790,{direction:n.dir})}}var st=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Nt(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return kd(this.inner)}size(){return this.innerSize}};var I_=new re(x.comparator);function ot(){return I_}var Wd=new re(x.comparator);function hr(...n){let e=Wd;for(let t of n)e=e.insert(t.key,t);return e}function Hd(n){let e=Wd;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function jt(){return fr()}function Qd(){return fr()}function fr(){return new st(n=>n.toString(),(n,e)=>n.isEqual(e))}var w_=new re(x.comparator),E_=new pe(x.comparator);function $(...n){let e=E_;for(let t of n)e=e.add(t);return e}var T_=new pe(G);function v_(){return T_}function zc(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_r(e)?"-0":e}}function Jd(n){return{integerValue:""+n}}function A_(n,e){return Zg(e)?Jd(e):zc(n,e)}var Sn=class{constructor(){this._=void 0}};function b_(n,e,t){return n instanceof Rn?(function(i,o){let a={fields:{[Od]:{stringValue:Dd},[xd]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&us(o)&&(o=ls(o)),o&&(a.fields[Vd]=o),{mapValue:a}})(t,e):n instanceof Jt?Xd(n,e):n instanceof Yt?Zd(n,e):(function(i,o){let a=Yd(i,o),u=qh(a)+qh(i.Ae);return aa(a)&&aa(i.Ae)?Jd(u):zc(i.serializer,u)})(n,e)}function S_(n,e,t){return n instanceof Jt?Xd(n,e):n instanceof Yt?Zd(n,e):t}function Yd(n,e){return n instanceof Pn?(function(r){return aa(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}var Rn=class extends Sn{},Jt=class extends Sn{constructor(e){super(),this.elements=e}};function Xd(n,e){let t=ef(e);for(let r of n.elements)t.some(i=>Ge(i,r))||t.push(r);return{arrayValue:{values:t}}}var Yt=class extends Sn{constructor(e){super(),this.elements=e}};function Zd(n,e){let t=ef(e);for(let r of n.elements)t=t.filter(i=>!Ge(i,r));return{arrayValue:{values:t}}}var Pn=class extends Sn{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function qh(n){return Z(n.integerValue||n.doubleValue)}function ef(n){return Uc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function R_(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof Jt&&i instanceof Jt||r instanceof Yt&&i instanceof Yt?Tn(r.elements,i.elements,Ge):r instanceof Pn&&i instanceof Pn?Ge(r.Ae,i.Ae):r instanceof Rn&&i instanceof Rn})(n.transform,e.transform)}var Ia=class{constructor(e,t){this.version=e,this.transformResults=t}},et=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Si(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Cn=class{};function tf(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new wr(n.key,et.none()):new Xt(n.key,n.data,et.none());{let t=n.data,r=Re.empty(),i=new pe(Pe.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new $e(n.key,r,new De(i.toArray()),et.none())}}function P_(n,e,t){n instanceof Xt?(function(i,o,a){let u=i.value.clone(),h=zh(i.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof $e?(function(i,o,a){if(!Si(i.precondition,o))return void o.convertToUnknownDocument(a.version);let u=zh(i.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(nf(i)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function pr(n,e,t,r){return n instanceof Xt?(function(o,a,u,h){if(!Si(o.precondition,a))return u;let d=o.value.clone(),p=Gh(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof $e?(function(o,a,u,h){if(!Si(o.precondition,a))return u;let d=Gh(o.fieldTransforms,h,a),p=a.data;return p.setAll(nf(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(y=>y.field))})(n,e,t,r):(function(o,a,u){return Si(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function C_(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),o=Yd(r.transform,i||null);o!=null&&(t===null&&(t=Re.empty()),t.set(r.field,o))}return t||null}function jh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Tn(r,i,(o,a)=>R_(o,a))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Xt=class extends Cn{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},$e=class extends Cn{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function nf(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function zh(n,e,t){let r=new Map;Q(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){let o=n[i],a=o.transform,u=e.data.field(o.field);r.set(o.field,S_(a,u,t[i]))}return r}function Gh(n,e,t){let r=new Map;for(let i of n){let o=i.transform,a=t.data.field(i.field);r.set(i.field,b_(o,a,e))}return r}var wr=class extends Cn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},wa=class extends Cn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ea=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&P_(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=pr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=pr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Qd();return this.mutations.forEach(i=>{let o=e.get(i.key),a=o.overlayedDocument,u=this.applyToLocalView(a,o.mutatedFields);u=t.has(i.key)?null:u;let h=tf(a,u);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(U.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),$())}isEqual(e){return this.batchId===e.batchId&&Tn(this.mutations,e.mutations,(t,r)=>jh(t,r))&&Tn(this.baseMutations,e.baseMutations,(t,r)=>jh(t,r))}},Ta=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Q(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return w_})(),o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new n(e,t,r,i)}};var va=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Aa=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ie,K;function N_(n){switch(n){case S.OK:return L(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return L(15467,{code:n})}}function rf(n){if(n===void 0)return tt("GRPC error has no .code"),S.UNKNOWN;switch(n){case ie.OK:return S.OK;case ie.CANCELLED:return S.CANCELLED;case ie.UNKNOWN:return S.UNKNOWN;case ie.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case ie.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case ie.INTERNAL:return S.INTERNAL;case ie.UNAVAILABLE:return S.UNAVAILABLE;case ie.UNAUTHENTICATED:return S.UNAUTHENTICATED;case ie.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case ie.NOT_FOUND:return S.NOT_FOUND;case ie.ALREADY_EXISTS:return S.ALREADY_EXISTS;case ie.PERMISSION_DENIED:return S.PERMISSION_DENIED;case ie.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case ie.ABORTED:return S.ABORTED;case ie.OUT_OF_RANGE:return S.OUT_OF_RANGE;case ie.UNIMPLEMENTED:return S.UNIMPLEMENTED;case ie.DATA_LOSS:return S.DATA_LOSS;default:return L(39323,{code:n})}}(K=ie||(ie={}))[K.OK=0]="OK",K[K.CANCELLED=1]="CANCELLED",K[K.UNKNOWN=2]="UNKNOWN",K[K.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",K[K.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",K[K.NOT_FOUND=5]="NOT_FOUND",K[K.ALREADY_EXISTS=6]="ALREADY_EXISTS",K[K.PERMISSION_DENIED=7]="PERMISSION_DENIED",K[K.UNAUTHENTICATED=16]="UNAUTHENTICATED",K[K.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",K[K.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",K[K.ABORTED=10]="ABORTED",K[K.OUT_OF_RANGE=11]="OUT_OF_RANGE",K[K.UNIMPLEMENTED=12]="UNIMPLEMENTED",K[K.INTERNAL=13]="INTERNAL",K[K.UNAVAILABLE=14]="UNAVAILABLE",K[K.DATA_LOSS=15]="DATA_LOSS";var k_=null;function D_(){return new TextEncoder}var O_=new Xe([4294967295,4294967295],0);function $h(n){let e=D_().encode(n),t=new Uo;return t.update(e),new Uint8Array(t.digest())}function Kh(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Xe([t,r],0),new Xe([i,o],0)]}var ba=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new zt(`Invalid padding: ${t}`);if(r<0)throw new zt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new zt(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new zt(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Xe.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(Xe.fromNumber(r)));return i.compare(O_)===1&&(i=new Xe([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let t=$h(e),[r,i]=Kh(t);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,i,o);if(!this.we(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new n(o,i,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.ge===0)return;let t=$h(e),[r,i]=Kh(t);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,i,o);this.Se(a)}}Se(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},zt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Mi=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Er.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(U.min(),i,new re(G),ot(),$())}},Er=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,$(),$(),$())}};var In=class{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}},Fi=class{constructor(e,t){this.targetId=e,this.Ce=t}},Ui=class{constructor(e,t,r=_e.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Bi=class{constructor(){this.ve=0,this.Fe=Wh(),this.Me=_e.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=$(),t=$(),r=$();return this.Fe.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:L(38017,{changeType:o})}}),new Er(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Wh()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},Sa=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=ot(),this.Je=Ti(),this.He=Ti(),this.Ye=new re(G)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:L(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,i)=>{this.rt(i)&&t(i)})}st(e){let t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){let o=i.target;if(_a(o))if(r===0){let a=new x(o.path);this.et(t,a,xe.newNoDocument(a,U.min()))}else Q(r===1,20013,{expectedCount:r});else{let a=this._t(t);if(a!==r){let u=this.ut(e),h=u?this.ct(u,e,a):1;if(h!==0){this.it(t);let d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}k_?.lt((function(p,y,w,R,D){let O={localCacheCount:p,existenceFilterCount:y.count,databaseId:w.database,projectId:w.projectId},C=y.unchangedNames;return C&&(O.bloomFilter={applied:D===0,hashCount:C?.hashCount??0,bitmapLength:C?.bits?.bitmap?.length??0,padding:C?.bits?.padding??0,mightContain:j=>R?.mightContain(j)??!1}),O})(a,e.Ce,this.Ge.ht(),u,h))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,a,u;try{a=rt(r).toUint8Array()}catch(h){if(h instanceof ki)return En("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new ba(a,i,o)}catch(h){return En(h instanceof zt?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),i++)}),i}Tt(e){let t=new Map;this.ze.forEach((o,a)=>{let u=this.ot(a);if(u){if(o.current&&_a(u.target)){let h=new x(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,xe.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.qe())}});let r=$();this.He.forEach((o,a)=>{let u=!0;a.forEachWhile(h=>{let d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.je.forEach((o,a)=>a.setReadTime(e));let i=new Mi(e,t,this.Ye,this.je,r);return this.je=ot(),this.Je=Ti(),this.He=Ti(),this.Ye=new re(G),i}Xe(e,t){if(!this.rt(e))return;let r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Bi,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new pe(G),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new pe(G),this.Je=this.Je.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Bi),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function Ti(){return new re(x.comparator)}function Wh(){return new re(x.comparator)}var V_={asc:"ASCENDING",desc:"DESCENDING"},x_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},L_={and:"AND",or:"OR"},Ra=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Pa(n,e){return n.useProto3Json||cs(e)?e:{value:e}}function qi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function sf(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function M_(n,e){return qi(n,e.toTimestamp())}function ze(n){return Q(!!n,49232),U.fromTimestamp((function(t){let r=nt(t);return new ee(r.seconds,r.nanos)})(n))}function Gc(n,e){return Ca(n,e).canonicalString()}function Ca(n,e){let t=(function(i){return new X(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function of(n){let e=X.fromString(n);return Q(hf(e),10190,{key:e.toString()}),e}function Na(n,e){return Gc(n.databaseId,e.path)}function Ko(n,e){let t=of(e);if(t.get(1)!==n.databaseId.projectId)throw new N(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new N(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new x(cf(t))}function af(n,e){return Gc(n.databaseId,e)}function F_(n){let e=of(n);return e.length===4?X.emptyPath():cf(e)}function ka(n){return new X(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function cf(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Hh(n,e,t){return{name:Na(n,e),fields:t.value.mapValue.fields}}function U_(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(Q(p===void 0||typeof p=="string",58123),_e.fromBase64String(p||"")):(Q(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),_e.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(d){let p=d.code===void 0?S.UNKNOWN:rf(d.code);return new N(p,d.message||"")})(a);t=new Ui(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Ko(n,r.document.name),o=ze(r.document.updateTime),a=r.document.createTime?ze(r.document.createTime):U.min(),u=new Re({mapValue:{fields:r.document.fields}}),h=xe.newFoundDocument(i,o,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new In(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Ko(n,r.document),o=r.readTime?ze(r.readTime):U.min(),a=xe.newNoDocument(i,o),u=r.removedTargetIds||[];t=new In([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Ko(n,r.document),o=r.removedTargetIds||[];t=new In([],o,i,null)}else{if(!("filter"in e))return L(11601,{Rt:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new Aa(i,o),u=r.targetId;t=new Fi(u,a)}}return t}function B_(n,e){let t;if(e instanceof Xt)t={update:Hh(n,e.key,e.value)};else if(e instanceof wr)t={delete:Na(n,e.key)};else if(e instanceof $e)t={update:Hh(n,e.key,e.data),updateMask:Q_(e.fieldMask)};else{if(!(e instanceof wa))return L(16599,{Vt:e.type});t={verify:Na(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>(function(o,a){let u=a.transform;if(u instanceof Rn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Jt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Yt)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Pn)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw L(20930,{transform:a.transform})})(0,r))),e.precondition.isNone||(t.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:M_(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:L(27497)})(n,e.precondition)),t}function q_(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map(t=>(function(i,o){let a=i.updateTime?ze(i.updateTime):ze(o);return a.isEqual(U.min())&&(a=ze(o)),new Ia(a,i.transformResults||[])})(t,e))):[]}function j_(n,e){return{documents:[af(n,e.path)]}}function z_(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=af(n,i);let o=(function(d){if(d.length!==0)return lf(Le.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);let a=(function(d){if(d.length!==0)return d.map(p=>(function(w){return{field:mn(w.field),direction:K_(w.dir)}})(p))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=Pa(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:i}}function G_(n){let e=F_(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Q(r===1,65062);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(y){let w=uf(y);return w instanceof Le&&qd(w)?w.getFilters():[w]})(t.where));let a=[];t.orderBy&&(a=(function(y){return y.map(w=>(function(D){return new Qt(gn(D.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(D.direction))})(w))})(t.orderBy));let u=null;t.limit&&(u=(function(y){let w;return w=typeof y=="object"?y.value:y,cs(w)?null:w})(t.limit));let h=null;t.startAt&&(h=(function(y){let w=!!y.before,R=y.values||[];return new Rt(R,w)})(t.startAt));let d=null;return t.endAt&&(d=(function(y){let w=!y.before,R=y.values||[];return new Rt(R,w)})(t.endAt)),m_(e,i,a,o,u,"F",h,d)}function $_(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function uf(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=gn(t.unaryFilter.field);return oe.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=gn(t.unaryFilter.field);return oe.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=gn(t.unaryFilter.field);return oe.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=gn(t.unaryFilter.field);return oe.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}})(n):n.fieldFilter!==void 0?(function(t){return oe.create(gn(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Le.create(t.compositeFilter.filters.map(r=>uf(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L(1026)}})(t.compositeFilter.op))})(n):L(30097,{filter:n})}function K_(n){return V_[n]}function W_(n){return x_[n]}function H_(n){return L_[n]}function mn(n){return{fieldPath:n.canonicalString()}}function gn(n){return Pe.fromServerFormat(n.fieldPath)}function lf(n){return n instanceof oe?(function(t){if(t.op==="=="){if(Lh(t.value))return{unaryFilter:{field:mn(t.field),op:"IS_NAN"}};if(xh(t.value))return{unaryFilter:{field:mn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Lh(t.value))return{unaryFilter:{field:mn(t.field),op:"IS_NOT_NAN"}};if(xh(t.value))return{unaryFilter:{field:mn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mn(t.field),op:W_(t.op),value:t.value}}})(n):n instanceof Le?(function(t){let r=t.getFilters().map(i=>lf(i));return r.length===1?r[0]:{compositeFilter:{op:H_(t.op),filters:r}}})(n):L(54877,{filter:n})}function Q_(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function hf(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Tr=class n{constructor(e,t,r,i,o=U.min(),a=U.min(),u=_e.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Da=class{constructor(e){this.yt=e}};function J_(n){let e=G_({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Li(e,e.limit,"L"):e}var ji=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Z(e.integerValue));else if("doubleValue"in e){let r=Z(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),_r(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=nt(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(rt(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?Fd(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Md(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):L(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let r=e.fields||{};this.Ft(t,55);for(let i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let i=vn,o=r[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Z(o)),this.Ot(i,t),this.Ct(r[i],t)}Qt(e,t){let r=e.values||[];this.Ft(t,50);for(let i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),x.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};ji.Kt=new ji;var Oa=class{constructor(){this.Cn=new Va}addToCollectionParentIndex(e,t){return this.Cn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Ht.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Ht.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},Va=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new pe(X.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new pe(X.comparator)).toArray()}};var RE=new Uint8Array(0);var Qh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},df=41943040,ke=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};ke.DEFAULT_COLLECTION_PERCENTILE=10,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ke.DEFAULT=new ke(df,ke.DEFAULT_COLLECTION_PERCENTILE,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ke.DISABLED=new ke(-1,0,0);var vr=class n{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new n(0)}static cr(){return new n(-1)}};var Jh="LruGarbageCollector",Y_=1048576;function Yh([n,e],[t,r]){let i=G(n,t);return i===0?G(e,r):i}var xa=class{constructor(e){this.Ir=e,this.buffer=new pe(Yh),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Yh(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},La=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){V(Jh,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ln(t)?V(Jh,"Ignoring IndexedDB error during garbage collection: ",t):await xn(t)}await this.Vr(3e5)})}},Ma=class{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return P.resolve(xc.ce);let r=new xa(t);return this.mr.forEachTarget(e,i=>r.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>r.Ar(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(Qh)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Qh):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,o,a,u,h,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(y=>(y>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),i=this.params.maximumSequenceNumbersToCollect):i=y,a=Date.now(),this.nthSequenceNumber(e,i))).next(y=>(r=y,u=Date.now(),this.removeTargets(e,r,t))).next(y=>(o=y,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(y=>(d=Date.now(),fn()<=z.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${y} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:y})))}};function X_(n,e){return new Ma(n,e)}var Fa=class{constructor(){this.changes=new st(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ua=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Ba=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&pr(r.mutation,i,De.empty(),ee.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,$()).next(()=>r))}getLocalViewOfDocuments(e,t,r=$()){let i=jt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=hr();return o.forEach((u,h)=>{a=a.insert(u,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=jt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,$()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,i){let o=ot(),a=fr(),u=(function(){return fr()})();return t.forEach((h,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof $e)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),pr(p.mutation,d,p.mutation.getFieldMask(),ee.now())):a.set(d.key,De.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>u.set(d,new Ua(p,a.get(d)??null))),u))}recalculateAndSaveOverlays(e,t){let r=fr(),i=new re((a,u)=>a-u),o=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(h=>{let d=t.get(h);if(d===null)return;let p=r.get(h)||De.empty();p=u.applyToLocalView(d,p),r.set(h,p);let y=(i.get(u.batchId)||$()).add(h);i=i.insert(u.batchId,y)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let h=u.getNext(),d=h.key,p=h.value,y=Qd();p.forEach(w=>{if(!o.has(w)){let R=tf(t.get(w),r.get(w));R!==null&&y.set(w,R),o=o.add(w)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,y))}return P.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return(function(a){return x.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):jc(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):P.resolve(jt()),u=gr,h=o;return a.next(d=>P.forEach(d,(p,y)=>(u<y.largestBatchId&&(u=y.largestBatchId),o.get(p)?P.resolve():this.remoteDocumentCache.getEntry(e,p).next(w=>{h=h.insert(p,w)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,h,d,$())).next(p=>({batchId:u,changes:Hd(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new x(t)).next(r=>{let i=hr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,a=hr();return this.indexManager.getCollectionParents(e,o).next(u=>P.forEach(u,h=>{let d=(function(y,w){return new it(w,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((y,w)=>{a=a.insert(y,w)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((h,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,xe.newInvalidDocument(p)))});let u=hr();return a.forEach((h,d)=>{let p=o.get(h);p!==void 0&&pr(p.mutation,d,De.empty(),ee.now()),fs(t,d)&&(u=u.insert(h,d))}),u})}};var qa=class{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return P.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:ze(i.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:J_(i.bundledQuery),readTime:ze(i.readTime)}})(t)),P.resolve()}};var ja=class{constructor(){this.overlays=new re(x.comparator),this.qr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let r=jt();return P.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.St(e,t,o)}),P.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.qr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.qr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){let i=jt(),o=t.length+1,a=new x(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let h=u.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new re((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=jt(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let u=jt(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((d,p)=>u.set(d,p)),!(u.size()>=i)););return P.resolve(u)}St(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new va(t,r));let o=this.qr.get(t);o===void 0&&(o=$(),this.qr.set(t,o)),this.qr.set(t,o.add(r.key))}};var za=class{constructor(){this.sessionToken=_e.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}};var Ar=class{constructor(){this.Qr=new pe(se.$r),this.Ur=new pe(se.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let r=new se(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new se(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){let t=new x(new X([])),r=new se(t,e),i=new se(t,e+1),o=[];return this.Ur.forEachInRange([r,i],a=>{this.Gr(a),o.push(a.key)}),o}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new x(new X([])),r=new se(t,e),i=new se(t,e+1),o=$();return this.Ur.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){let t=new se(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},se=class{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return x.comparator(e.key,t.key)||G(e.Yr,t.Yr)}static Kr(e,t){return G(e.Yr,t.Yr)||x.comparator(e.key,t.key)}};var Ga=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new pe(se.$r)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Ea(o,t,r,i);this.mutationQueue.push(a);for(let u of i)this.Zr=this.Zr.add(new se(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.ei(r),o=i<0?0:i;return P.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?Lc:this.tr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new se(t,0),i=new se(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,i],a=>{let u=this.Xr(a.Yr);o.push(u)}),P.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new pe(G);return t.forEach(i=>{let o=new se(i,0),a=new se(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],u=>{r=r.add(u.Yr)})}),P.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;x.isDocumentKey(o)||(o=o.child(""));let a=new se(new x(o),0),u=new pe(G);return this.Zr.forEachWhile(h=>{let d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(u=u.add(h.Yr)),!0)},a),P.resolve(this.ti(u))}ti(e){let t=[];return e.forEach(r=>{let i=this.Xr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Q(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return P.forEach(t.mutations,i=>{let o=new se(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){let r=new se(t,0),i=this.Zr.firstAfterOrEqual(r);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var $a=class{constructor(e){this.ri=e,this.docs=(function(){return new re(x.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():xe.newInvalidDocument(t))}getEntries(e,t){let r=ot();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():xe.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=ot(),a=t.path,u=new x(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){let{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Jg(Qg(p),r)<=0||(i.has(p.key)||fs(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return P.resolve(o)}getAllFromCollectionGroup(e,t,r,i){L(9500)}ii(e,t){return P.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Ka(this)}getSize(e){return P.resolve(this.size)}},Ka=class extends Fa{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)}),P.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}};var Wa=class{constructor(e){this.persistence=e,this.si=new st(t=>Bc(t),qc),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.oi=0,this._i=new Ar,this.targetCount=0,this.ai=vr.ur()}forEachTarget(e,t){return this.si.forEach((r,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),P.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new vr(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Pr(t),P.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.si.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),P.waitFor(o).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let r=this.si.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),P.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),P.resolve()}getMatchingKeysForTargetId(e,t){let r=this._i.Hr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this._i.containsKey(t))}};var zi=class{constructor(e,t){this.ui={},this.overlays={},this.ci=new xc(0),this.li=!1,this.li=!0,this.hi=new za,this.referenceDelegate=e(this),this.Pi=new Wa(this),this.indexManager=new Oa,this.remoteDocumentCache=(function(i){return new $a(i)})(r=>this.referenceDelegate.Ti(r)),this.serializer=new Da(t),this.Ii=new qa(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ja,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new Ga(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);let i=new Ha(this.ci.next());return this.referenceDelegate.Ei(),r(i).next(o=>this.referenceDelegate.di(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Ai(e,t){return P.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}},Ha=class extends ia{constructor(e){super(),this.currentSequenceNumber=e}},Qa=class n{constructor(e){this.persistence=e,this.Ri=new Ar,this.Vi=null}static mi(e){return new n(e)}get fi(){if(this.Vi)return this.Vi;throw L(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(i=>this.fi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.fi.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.fi,r=>{let i=x.fromPath(r);return this.gi(e,i).next(o=>{o||t.removeEntry(i,U.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}},Gi=class n{constructor(e,t){this.persistence=e,this.pi=new st(r=>e_(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=X_(this,t)}static mi(e,t){return new n(e,t)}Ei(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return P.forEach(this.pi,(r,i)=>this.br(e,r,i).next(o=>o?P.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ii(e,a=>this.br(e,a,t).next(u=>{u||(r++,o.removeEntry(a,U.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ai(e.data.value)),t}br(e,t,r){return P.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.pi.get(t);return P.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Ja=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=$(),i=$();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var Ya=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Xa=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return ih()?8:Xg(de())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.ys(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ws(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new Ya;return this.Ss(e,t,a).next(u=>{if(o.result=u,this.Vs)return this.bs(e,t,a,u.size)})}).next(()=>o.result)}bs(e,t,r,i){return r.documentReadCount<this.fs?(fn()<=z.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",pn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),P.resolve()):(fn()<=z.DEBUG&&V("QueryEngine","Query:",pn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(fn()<=z.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",pn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,je(t))):P.resolve())}ys(e,t){if(Bh(t))return P.resolve(null);let r=je(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Li(t,null,"F"),r=je(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let a=$(...o);return this.ps.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(h=>{let d=this.Ds(t,u);return this.Cs(t,d,a,h.readTime)?this.ys(e,Li(t,null,"F")):this.vs(e,d,t,h)}))})))}ws(e,t,r,i){return Bh(t)||i.isEqual(U.min())?P.resolve(null):this.ps.getDocuments(e,r).next(o=>{let a=this.Ds(t,o);return this.Cs(t,a,r,i)?P.resolve(null):(fn()<=z.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),pn(t)),this.vs(e,a,t,Hg(i,gr)).next(u=>u))})}Ds(e,t){let r=new pe(Kd(e));return t.forEach((i,o)=>{fs(e,o)&&(r=r.add(o))}),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,t,r){return fn()<=z.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",pn(t)),this.ps.getDocumentsMatchingQuery(e,t,Ht.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}};var $c="LocalStore",Z_=3e8,Za=class{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new re(G),this.xs=new st(o=>Bc(o),qc),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ba(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}};function ey(n,e,t,r){return new Za(n,e,t,r)}async function ff(n,e){let t=F(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],u=[],h=$();for(let d of i){a.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}for(let d of o){u.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next(d=>({Ls:d,removedBatchIds:a,addedBatchIds:u}))})})}function ty(n,e){let t=F(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,d,p){let y=d.batch,w=y.keys(),R=P.resolve();return w.forEach(D=>{R=R.next(()=>p.getEntry(h,D)).next(O=>{let C=d.docVersions.get(D);Q(C!==null,48541),O.version.compareTo(C)<0&&(y.applyToRemoteDocument(O,d),O.isValidDocument()&&(O.setReadTime(d.commitVersion),p.addEntry(O)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(h,y))})(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=$();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h})(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function pf(n){let e=F(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function ny(n,e){let t=F(n),r=e.snapshotVersion,i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;let u=[];e.targetChanges.forEach((p,y)=>{let w=i.get(y);if(!w)return;u.push(t.Pi.removeMatchingKeys(o,p.removedDocuments,y).next(()=>t.Pi.addMatchingKeys(o,p.addedDocuments,y)));let R=w.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(y)!==null?R=R.withResumeToken(_e.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(y,R),(function(O,C,j){return O.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=Z_?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0})(w,R,p)&&u.push(t.Pi.updateTargetData(o,R))});let h=ot(),d=$();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))}),u.push(ry(o,a,e.documentUpdates).next(p=>{h=p.ks,d=p.qs})),!r.isEqual(U.min())){let p=t.Pi.getLastRemoteSnapshotVersion(o).next(y=>t.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(p)}return P.waitFor(u).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,d)).next(()=>h)}).then(o=>(t.Ms=i,o))}function ry(n,e,t){let r=$(),i=$();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=ot();return t.forEach((u,h)=>{let d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),h.isNoDocument()&&h.version.isEqual(U.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):V($c,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)}),{ks:a,qs:i}})}function iy(n,e){let t=F(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Lc),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function sy(n,e){let t=F(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Pi.getTargetData(r,e).next(o=>o?(i=o,P.resolve(i)):t.Pi.allocateTargetId(r).next(a=>(i=new Tr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function ec(n,e,t){let r=F(n),i=r.Ms.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!Ln(a))throw a;V($c,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function Xh(n,e,t){let r=F(n),i=U.min(),o=$();return r.persistence.runTransaction("Execute query","readwrite",a=>(function(h,d,p){let y=F(h),w=y.xs.get(p);return w!==void 0?P.resolve(y.Ms.get(w)):y.Pi.getTargetData(d,p)})(r,a,je(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,u.targetId).next(h=>{o=h})}).next(()=>r.Fs.getDocumentsMatchingQuery(a,e,t?i:U.min(),t?o:$())).next(u=>(oy(r,__(e),u),{documents:u,Qs:o})))}function oy(n,e,t){let r=n.Os.get(e)||U.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Os.set(e,r)}var $i=class{constructor(){this.activeTargetIds=v_()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var tc=class{constructor(){this.Mo=new $i,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new $i,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var nc=class{Oo(e){}shutdown(){}};var Zh="ConnectivityMonitor",Ki=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){V(Zh,"Network connectivity changed: AVAILABLE");for(let e of this.qo)e(0)}ko(){V(Zh,"Network connectivity changed: UNAVAILABLE");for(let e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var vi=null;function rc(){return vi===null?vi=(function(){return 268435456+Math.round(2147483648*Math.random())})():vi++,"0x"+vi.toString(16)}var Wo="RestConnection",ay={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},ic=class{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Di?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,o){let a=rc(),u=this.zo(e,t.toUriEncodedString());V(Wo,`Sending RPC '${e}' ${a}:`,u,r);let h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,i,o);let{host:d}=new URL(u),p=_t(d);return this.Jo(e,u,h,r,p).then(y=>(V(Wo,`Received RPC '${e}' ${a}: `,y),y),y=>{throw En(Wo,`RPC '${e}' ${a} failed with error: `,y,"url: ",u,"request:",r),y})}Ho(e,t,r,i,o,a){return this.Go(e,t,r,i,o)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Vn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}zo(e,t){let r=ay[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}};var sc=class{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}};var ge="WebChannelConnection",oc=class extends ic{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,o){let a=rc();return new Promise((u,h)=>{let d=new Bo;d.setWithCredentials(!0),d.listenOnce(qo.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case lr.NO_ERROR:let y=d.getResponseJson();V(ge,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(y)),u(y);break;case lr.TIMEOUT:V(ge,`RPC '${e}' ${a} timed out`),h(new N(S.DEADLINE_EXCEEDED,"Request time out"));break;case lr.HTTP_ERROR:let w=d.getStatus();if(V(ge,`RPC '${e}' ${a} failed with status:`,w,"response text:",d.getResponseText()),w>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let D=R?.error;if(D&&D.status&&D.message){let O=(function(j){let W=j.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(W)>=0?W:S.UNKNOWN})(D.status);h(new N(O,D.message))}else h(new N(S.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new N(S.UNAVAILABLE,"Connection failed."));break;default:L(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{V(ge,`RPC '${e}' ${a} completed.`)}});let p=JSON.stringify(i);V(ge,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",p,r,15)})}T_(e,t,r){let i=rc(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Go(),u=zo(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;let p=o.join("");V(ge,`Creating RPC '${e}' stream ${i}: ${p}`,h);let y=a.createWebChannel(p,h);this.I_(y);let w=!1,R=!1,D=new sc({Yo:C=>{R?V(ge,`Not sending because RPC '${e}' stream ${i} is closed:`,C):(w||(V(ge,`Opening RPC '${e}' stream ${i} transport.`),y.open(),w=!0),V(ge,`RPC '${e}' stream ${i} sending:`,C),y.send(C))},Zo:()=>y.close()}),O=(C,j,W)=>{C.listen(j,H=>{try{W(H)}catch(ye){setTimeout(()=>{throw ye},0)}})};return O(y,dn.EventType.OPEN,()=>{R||(V(ge,`RPC '${e}' stream ${i} transport opened.`),D.o_())}),O(y,dn.EventType.CLOSE,()=>{R||(R=!0,V(ge,`RPC '${e}' stream ${i} transport closed`),D.a_(),this.E_(y))}),O(y,dn.EventType.ERROR,C=>{R||(R=!0,En(ge,`RPC '${e}' stream ${i} transport errored. Name:`,C.name,"Message:",C.message),D.a_(new N(S.UNAVAILABLE,"The operation could not be completed")))}),O(y,dn.EventType.MESSAGE,C=>{if(!R){let j=C.data[0];Q(!!j,16349);let W=j,H=W?.error||W[0]?.error;if(H){V(ge,`RPC '${e}' stream ${i} received error:`,H);let ye=H.status,Ee=(function(m){let _=ie[m];if(_!==void 0)return rf(_)})(ye),le=H.message;Ee===void 0&&(Ee=S.INTERNAL,le="Unknown error status: "+ye+" with message "+H.message),R=!0,D.a_(new N(Ee,le)),y.close()}else V(ge,`RPC '${e}' stream ${i} received:`,j),D.u_(j)}}),O(u,jo.STAT_EVENT,C=>{C.stat===wi.PROXY?V(ge,`RPC '${e}' stream ${i} detected buffering proxy`):C.stat===wi.NOPROXY&&V(ge,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{D.__()},0),D}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}};function Ho(){return typeof document<"u"?document:null}function ps(n){return new Ra(n,!0)}var Wi=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var ed="PersistentStream",Hi=class{constructor(e,t,r,i,o,a,u,h){this.Mi=e,this.S_=r,this.b_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Wi(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(tt(t.toString()),tt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===t&&this.G_(r,i)},r=>{e(()=>{let i=new N(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,t){let r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.J_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return V(ed,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(V(ed,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},ac=class extends Hi{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=U_(this.serializer,e),r=(function(o){if(!("targetChange"in o))return U.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?ze(a.readTime):U.min()})(e);return this.listener.H_(t,r)}Y_(e){let t={};t.database=ka(this.serializer),t.addTarget=(function(o,a){let u,h=a.target;if(u=_a(h)?{documents:j_(o,h)}:{query:z_(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=sf(o,a.resumeToken);let d=Pa(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){u.readTime=qi(o,a.snapshotVersion.toTimestamp());let d=Pa(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,e);let r=$_(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){let t={};t.database=ka(this.serializer),t.removeTarget=e,this.q_(t)}},cc=class extends Hi{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=q_(e.writeResults,e.commitTime),r=ze(e.commitTime);return this.listener.na(r,t)}ra(){let e={};e.database=ka(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>B_(this.serializer,r))};this.q_(t)}};var uc=class{},lc=class extends uc{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new N(S.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Go(e,Ca(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new N(S.UNKNOWN,o.toString())})}Ho(e,t,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Ho(e,Ca(t,r),i,a,u,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new N(S.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},hc=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(tt(t),this.aa=!1):V("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var Zt="RemoteStore",dc=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo(a=>{r.enqueueAndForget(async()=>{en(this)&&(V(Zt,"Restarting streams for network reachability change."),await(async function(h){let d=F(h);d.Ea.add(4),await Dr(d),d.Ra.set("Unknown"),d.Ea.delete(4),await ms(d)})(this))})}),this.Ra=new hc(r,i)}};async function ms(n){if(en(n))for(let e of n.da)await e(!0)}async function Dr(n){for(let e of n.da)await e(!1)}function mf(n,e){let t=F(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Qc(t)?Hc(t):Mn(t).O_()&&Wc(t,e))}function Kc(n,e){let t=F(n),r=Mn(t);t.Ia.delete(e),r.O_()&&gf(t,e),t.Ia.size===0&&(r.O_()?r.L_():en(t)&&t.Ra.set("Unknown"))}function Wc(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(U.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Mn(n).Y_(e)}function gf(n,e){n.Va.Ue(e),Mn(n).Z_(e)}function Hc(n){n.Va=new Sa({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Mn(n).start(),n.Ra.ua()}function Qc(n){return en(n)&&!Mn(n).x_()&&n.Ia.size>0}function en(n){return F(n).Ea.size===0}function _f(n){n.Va=void 0}async function cy(n){n.Ra.set("Online")}async function uy(n){n.Ia.forEach((e,t)=>{Wc(n,e)})}async function ly(n,e){_f(n),Qc(n)?(n.Ra.ha(e),Hc(n)):n.Ra.set("Unknown")}async function hy(n,e,t){if(n.Ra.set("Online"),e instanceof Ui&&e.state===2&&e.cause)try{await(async function(i,o){let a=o.cause;for(let u of o.targetIds)i.Ia.has(u)&&(await i.remoteSyncer.rejectListen(u,a),i.Ia.delete(u),i.Va.removeTarget(u))})(n,e)}catch(r){V(Zt,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Qi(n,r)}else if(e instanceof In?n.Va.Ze(e):e instanceof Fi?n.Va.st(e):n.Va.tt(e),!t.isEqual(U.min()))try{let r=await pf(n.localStore);t.compareTo(r)>=0&&await(function(o,a){let u=o.Va.Tt(a);return u.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){let p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}}),u.targetMismatches.forEach((h,d)=>{let p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(_e.EMPTY_BYTE_STRING,p.snapshotVersion)),gf(o,h);let y=new Tr(p.target,h,d,p.sequenceNumber);Wc(o,y)}),o.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(r){V(Zt,"Failed to raise snapshot:",r),await Qi(n,r)}}async function Qi(n,e,t){if(!Ln(e))throw e;n.Ea.add(1),await Dr(n),n.Ra.set("Offline"),t||(t=()=>pf(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{V(Zt,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await ms(n)})}function yf(n,e){return e().catch(t=>Qi(n,t,e))}async function gs(n){let e=F(n),t=Pt(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Lc;for(;dy(e);)try{let i=await iy(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,fy(e,i)}catch(i){await Qi(e,i)}If(e)&&wf(e)}function dy(n){return en(n)&&n.Ta.length<10}function fy(n,e){n.Ta.push(e);let t=Pt(n);t.O_()&&t.X_&&t.ea(e.mutations)}function If(n){return en(n)&&!Pt(n).x_()&&n.Ta.length>0}function wf(n){Pt(n).start()}async function py(n){Pt(n).ra()}async function my(n){let e=Pt(n);for(let t of n.Ta)e.ea(t.mutations)}async function gy(n,e,t){let r=n.Ta.shift(),i=Ta.from(r,e,t);await yf(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await gs(n)}async function _y(n,e){e&&Pt(n).X_&&await(async function(r,i){if((function(a){return N_(a)&&a!==S.ABORTED})(i.code)){let o=r.Ta.shift();Pt(r).B_(),await yf(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),await gs(r)}})(n,e),If(n)&&wf(n)}async function td(n,e){let t=F(n);t.asyncQueue.verifyOperationInProgress(),V(Zt,"RemoteStore received new credentials");let r=en(t);t.Ea.add(3),await Dr(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await ms(t)}async function yy(n,e){let t=F(n);e?(t.Ea.delete(2),await ms(t)):e||(t.Ea.add(2),await Dr(t),t.Ra.set("Unknown"))}function Mn(n){return n.ma||(n.ma=(function(t,r,i){let o=F(t);return o.sa(),new ac(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(n.datastore,n.asyncQueue,{Xo:cy.bind(null,n),t_:uy.bind(null,n),r_:ly.bind(null,n),H_:hy.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),Qc(n)?Hc(n):n.Ra.set("Unknown")):(await n.ma.stop(),_f(n))})),n.ma}function Pt(n){return n.fa||(n.fa=(function(t,r,i){let o=F(t);return o.sa(),new cc(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:py.bind(null,n),r_:_y.bind(null,n),ta:my.bind(null,n),na:gy.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await gs(n)):(await n.fa.stop(),n.Ta.length>0&&(V(Zt,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}var fc=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new Ve,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let a=Date.now()+r,u=new n(e,t,a,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new N(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Jc(n,e){if(tt("AsyncQueue",`${e}: ${n}`),Ln(n))return new N(S.UNAVAILABLE,`${e}: ${n}`);throw n}var Ji=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||x.comparator(t.key,r.key):(t,r)=>x.comparator(t.key,r.key),this.keyedMap=hr(),this.sortedSet=new re(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Yi=class{constructor(){this.ga=new re(x.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):L(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}},Nn=class n{constructor(e,t,r,i,o,a,u,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,o){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new n(e,t,Ji.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ds(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var pc=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}},mc=class{constructor(){this.queries=nd(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let i=F(t),o=i.queries;i.queries=nd(),o.forEach((a,u)=>{for(let h of u.Sa)h.onError(r)})})(this,new N(S.ABORTED,"Firestore shutting down"))}};function nd(){return new st(n=>$d(n),ds)}async function Yc(n,e){let t=F(n),r=3,i=e.query,o=t.queries.get(i);o?!o.ba()&&e.Da()&&(r=2):(o=new pc,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(i,!0);break;case 1:o.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){let u=Jc(a,`Initialization of query '${pn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,o),o.Sa.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&Zc(t)}async function Xc(n,e){let t=F(n),r=e.query,i=3,o=t.queries.get(r);if(o){let a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?i=e.Da()?0:1:!o.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Iy(n,e){let t=F(n),r=!1;for(let i of e){let o=i.query,a=t.queries.get(o);if(a){for(let u of a.Sa)u.Fa(i)&&(r=!0);a.wa=i}}r&&Zc(t)}function wy(n,e,t){let r=F(n),i=r.queries.get(e);if(i)for(let o of i.Sa)o.onError(t);r.queries.delete(e)}function Zc(n){n.Ca.forEach(e=>{e.next()})}var gc,rd;(rd=gc||(gc={})).Ma="default",rd.Cache="cache";var br=class{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Nn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Nn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==gc.Cache}};var Xi=class{constructor(e){this.key=e}},Zi=class{constructor(e){this.key=e}},_c=class{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=$(),this.mutatedKeys=$(),this.eu=Kd(e),this.tu=new Ji(this.eu)}get nu(){return this.Ya}ru(e,t){let r=t?t.iu:new Yi,i=t?t.tu:this.tu,o=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,y)=>{let w=i.get(p),R=fs(this.query,y)?y:null,D=!!w&&this.mutatedKeys.has(w.key),O=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),C=!1;w&&R?w.data.isEqual(R.data)?D!==O&&(r.track({type:3,doc:R}),C=!0):this.su(w,R)||(r.track({type:2,doc:R}),C=!0,(h&&this.eu(R,h)>0||d&&this.eu(R,d)<0)&&(u=!0)):!w&&R?(r.track({type:0,doc:R}),C=!0):w&&!R&&(r.track({type:1,doc:w}),C=!0,(h||d)&&(u=!0)),C&&(R?(a=a.add(R),o=O?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let a=e.iu.ya();a.sort((p,y)=>(function(R,D){let O=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{Rt:C})}};return O(R)-O(D)})(p.type,y.type)||this.eu(p.doc,y.doc)),this.ou(r),i=i??!1;let u=t&&!i?this._u():[],h=this.Xa.size===0&&this.current&&!i?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new Nn(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Yi,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=$(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});let t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new Zi(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new Xi(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=$();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Nn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},eu="SyncEngine",yc=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Ic=class{constructor(e){this.key=e,this.hu=!1}},wc=class{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new st(u=>$d(u),ds),this.Iu=new Map,this.Eu=new Set,this.du=new re(x.comparator),this.Au=new Map,this.Ru=new Ar,this.Vu={},this.mu=new Map,this.fu=vr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};async function Ey(n,e,t=!0){let r=Sf(n),i,o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=await Ef(r,e,t,!0),i}async function Ty(n,e){let t=Sf(n);await Ef(t,e,!0,!1)}async function Ef(n,e,t,r){let i=await sy(n.localStore,je(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t),u;return r&&(u=await vy(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&mf(n.remoteStore,i),u}async function vy(n,e,t,r,i){n.pu=(y,w,R)=>(async function(O,C,j,W){let H=C.view.ru(j);H.Cs&&(H=await Xh(O.localStore,C.query,!1).then(({documents:E})=>C.view.ru(E,H)));let ye=W&&W.targetChanges.get(C.targetId),Ee=W&&W.targetMismatches.get(C.targetId)!=null,le=C.view.applyChanges(H,O.isPrimaryClient,ye,Ee);return sd(O,C.targetId,le.au),le.snapshot})(n,y,w,R);let o=await Xh(n.localStore,e,!0),a=new _c(e,o.Qs),u=a.ru(o.documents),h=Er.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(u,n.isPrimaryClient,h);sd(n,t,d.au);let p=new yc(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function Ay(n,e,t){let r=F(n),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter(a=>!ds(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await ec(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Kc(r.remoteStore,i.targetId),Ec(r,i.targetId)}).catch(xn)):(Ec(r,i.targetId),await ec(r.localStore,i.targetId,!0))}async function by(n,e){let t=F(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Kc(t.remoteStore,r.targetId))}async function Sy(n,e,t){let r=Oy(n);try{let i=await(function(a,u){let h=F(a),d=ee.now(),p=u.reduce((R,D)=>R.add(D.key),$()),y,w;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let D=ot(),O=$();return h.Ns.getEntries(R,p).next(C=>{D=C,D.forEach((j,W)=>{W.isValidDocument()||(O=O.add(j))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,D)).next(C=>{y=C;let j=[];for(let W of u){let H=C_(W,y.get(W.key).overlayedDocument);H!=null&&j.push(new $e(W.key,H,Ud(H.value.mapValue),et.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,j,u)}).next(C=>{w=C;let j=C.applyToLocalDocumentSet(y,O);return h.documentOverlayCache.saveOverlays(R,C.batchId,j)})}).then(()=>({batchId:w.batchId,changes:Hd(y)}))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(a,u,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new re(G)),d=d.insert(u,h),a.Vu[a.currentUser.toKey()]=d})(r,i.batchId,t),await Or(r,i.changes),await gs(r.remoteStore)}catch(i){let o=Jc(i,"Failed to persist write");t.reject(o)}}async function Tf(n,e){let t=F(n);try{let r=await ny(t.localStore,e);e.targetChanges.forEach((i,o)=>{let a=t.Au.get(o);a&&(Q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?Q(a.hu,14607):i.removedDocuments.size>0&&(Q(a.hu,42227),a.hu=!1))}),await Or(t,r,e)}catch(r){await xn(r)}}function id(n,e,t){let r=F(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Tu.forEach((o,a)=>{let u=a.view.va(e);u.snapshot&&i.push(u.snapshot)}),(function(a,u){let h=F(a);h.onlineState=u;let d=!1;h.queries.forEach((p,y)=>{for(let w of y.Sa)w.va(u)&&(d=!0)}),d&&Zc(h)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Ry(n,e,t){let r=F(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Au.get(e),o=i&&i.key;if(o){let a=new re(x.comparator);a=a.insert(o,xe.newNoDocument(o,U.min()));let u=$().add(o),h=new Mi(U.min(),new Map,new re(G),a,u);await Tf(r,h),r.du=r.du.remove(o),r.Au.delete(e),tu(r)}else await ec(r.localStore,e,!1).then(()=>Ec(r,e,t)).catch(xn)}async function Py(n,e){let t=F(n),r=e.batch.batchId;try{let i=await ty(t.localStore,e);Af(t,r,null),vf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Or(t,i)}catch(i){await xn(i)}}async function Cy(n,e,t){let r=F(n);try{let i=await(function(a,u){let h=F(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return h.mutationQueue.lookupMutationBatch(d,u).next(y=>(Q(y!==null,37113),p=y.keys(),h.mutationQueue.removeMutationBatch(d,y))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>h.localDocuments.getDocuments(d,p))})})(r.localStore,e);Af(r,e,t),vf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Or(r,i)}catch(i){await xn(i)}}function vf(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Af(n,e,t){let r=F(n),i=r.Vu[r.currentUser.toKey()];if(i){let o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Ec(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||bf(n,r)})}function bf(n,e){n.Eu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(Kc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),tu(n))}function sd(n,e,t){for(let r of t)r instanceof Xi?(n.Ru.addReference(r.key,e),Ny(n,r)):r instanceof Zi?(V(eu,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||bf(n,r.key)):L(19791,{wu:r})}function Ny(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(V(eu,"New document in limbo: "+t),n.Eu.add(r),tu(n))}function tu(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Eu.values().next().value;n.Eu.delete(e);let t=new x(X.fromString(e)),r=n.fu.next();n.Au.set(r,new Ic(t)),n.du=n.du.insert(t,r),mf(n.remoteStore,new Tr(je(hs(t.path)),r,"TargetPurposeLimboResolution",xc.ce))}}async function Or(n,e,t){let r=F(n),i=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((u,h)=>{a.push(r.pu(h,e,t).then(d=>{if((d||t)&&r.isPrimaryClient){let p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){i.push(d);let p=Ja.As(h.targetId,d);o.push(p)}}))}),await Promise.all(a),r.Pu.H_(i),await(async function(h,d){let p=F(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",y=>P.forEach(d,w=>P.forEach(w.Es,R=>p.persistence.referenceDelegate.addReference(y,w.targetId,R)).next(()=>P.forEach(w.ds,R=>p.persistence.referenceDelegate.removeReference(y,w.targetId,R)))))}catch(y){if(!Ln(y))throw y;V($c,"Failed to update sequence numbers: "+y)}for(let y of d){let w=y.targetId;if(!y.fromCache){let R=p.Ms.get(w),D=R.snapshotVersion,O=R.withLastLimboFreeSnapshotVersion(D);p.Ms=p.Ms.insert(w,O)}}})(r.localStore,o))}async function ky(n,e){let t=F(n);if(!t.currentUser.isEqual(e)){V(eu,"User change. New user:",e.toKey());let r=await ff(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach(u=>{u.forEach(h=>{h.reject(new N(S.CANCELLED,a))})}),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Or(t,r.Ls)}}function Dy(n,e){let t=F(n),r=t.Au.get(e);if(r&&r.hu)return $().add(r.key);{let i=$(),o=t.Iu.get(e);if(!o)return i;for(let a of o){let u=t.Tu.get(a);i=i.unionWith(u.view.nu)}return i}}function Sf(n){let e=F(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Tf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Dy.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ry.bind(null,e),e.Pu.H_=Iy.bind(null,e.eventManager),e.Pu.yu=wy.bind(null,e.eventManager),e}function Oy(n){let e=F(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Py.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Cy.bind(null,e),e}var Rf=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=ps(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,r){return null}Mu(t,r){return null}vu(t){return ey(this.persistence,new Xa,t.initialUser,this.serializer)}Cu(t){return new zi(Qa.mi,this.serializer)}Du(t){return new tc}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}return n.provider={build:()=>new n},n})(),Tc=class extends Rf{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Q(this.persistence.referenceDelegate instanceof Gi,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new La(r,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes!==void 0?ke.withCacheSize(this.cacheSizeBytes):ke.DEFAULT;return new zi(r=>Gi.mi(r,t),this.serializer)}};var Vy=(()=>{class n{async initialize(t,r){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>id(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=ky.bind(null,this.syncEngine),await yy(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new mc})()}createDatastore(t){let r=ps(t.databaseInfo.databaseId),i=(function(a){return new oc(a)})(t.databaseInfo);return(function(a,u,h,d){return new lc(a,u,h,d)})(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,o,a,u,h){return new dc(i,o,a,u,h)})(this.localStore,this.datastore,t.asyncQueue,r=>id(this.syncEngine,r,0),(function(){return Ki.v()?new Ki:new nc})())}createSyncEngine(t,r){return(function(o,a,u,h,d,p,y){let w=new wc(o,a,u,h,d,p);return y&&(w.gu=!0),w})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}async terminate(){await(async function(r){let i=F(r);V(Zt,"RemoteStore shutting down."),i.Ea.add(5),await Dr(i),i.Aa.shutdown(),i.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}return n.provider={build:()=>new n},n})();var Sr=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):tt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Ct="FirestoreClient",vc=class{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=fe.UNAUTHENTICATED,this.clientId=mr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async a=>{V(Ct,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(V(Ct,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ve;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Jc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}};async function Qo(n,e){n.asyncQueue.verifyOperationInProgress(),V(Ct,"Initializing OfflineComponentProvider");let t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await ff(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function od(n,e){n.asyncQueue.verifyOperationInProgress();let t=await xy(n);V(Ct,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>td(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>td(e.remoteStore,i)),n._onlineComponents=e}async function xy(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V(Ct,"Using user provided OfflineComponentProvider");try{await Qo(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===S.FAILED_PRECONDITION||i.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;En("Error using user provided cache. Falling back to memory cache: "+t),await Qo(n,new Rf)}}else V(Ct,"Using default OfflineComponentProvider"),await Qo(n,new Tc(void 0));return n._offlineComponents}async function Pf(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(V(Ct,"Using user provided OnlineComponentProvider"),await od(n,n._uninitializedComponentsProvider._online)):(V(Ct,"Using default OnlineComponentProvider"),await od(n,new Vy))),n._onlineComponents}function Ly(n){return Pf(n).then(e=>e.syncEngine)}async function es(n){let e=await Pf(n),t=e.eventManager;return t.onListen=Ey.bind(null,e.syncEngine),t.onUnlisten=Ay.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Ty.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=by.bind(null,e.syncEngine),t}function My(n,e,t={}){let r=new Ve;return n.asyncQueue.enqueueAndForget(async()=>(function(o,a,u,h,d){let p=new Sr({next:w=>{p.Nu(),a.enqueueAndForget(()=>Xc(o,y));let R=w.docs.has(u);!R&&w.fromCache?d.reject(new N(S.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&w.fromCache&&h&&h.source==="server"?d.reject(new N(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(w)},error:w=>d.reject(w)}),y=new br(hs(u.path),p,{includeMetadataChanges:!0,qa:!0});return Yc(o,y)})(await es(n),n.asyncQueue,e,t,r)),r.promise}function Fy(n,e,t={}){let r=new Ve;return n.asyncQueue.enqueueAndForget(async()=>(function(o,a,u,h,d){let p=new Sr({next:w=>{p.Nu(),a.enqueueAndForget(()=>Xc(o,y)),w.fromCache&&h.source==="server"?d.reject(new N(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(w)},error:w=>d.reject(w)}),y=new br(u,p,{includeMetadataChanges:!0,qa:!0});return Yc(o,y)})(await es(n),n.asyncQueue,e,t,r)),r.promise}function Cf(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var ad=new Map;var Nf="firestore.googleapis.com",cd=!0,ts=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new N(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Nf,this.ssl=cd}else this.host=e.host,this.ssl=e.ssl??cd;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=df;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Y_)throw new N(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Kg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Cf(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new N(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new N(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new N(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},kn=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ts({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new N(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new N(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ts(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Jo;switch(r.type){case"firstParty":return new ea(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new N(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=ad.get(t);r&&(V("ComponentProvider","Removing Datastore"),ad.delete(t),r.terminate())})(this),Promise.resolve()}};function Uy(n,e,t,r={}){n=Ce(n,kn);let i=_t(e),o=n._getSettings(),a=be(q({},o),{emulatorOptions:n._getEmulatorOptions()}),u=`${e}:${t}`;i&&(fi(`https://${u}`),pi("Firestore",!0)),o.host!==Nf&&o.host!==u&&En("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=be(q({},o),{host:u,ssl:i,emulatorOptions:r});if(!Ue(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=fe.MOCK_USER;else{d=Xl(r.mockUserToken,n._app?.options.projectId);let y=r.mockUserToken.sub||r.mockUserToken.user_id;if(!y)throw new N(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new fe(y)}n._authCredentials=new Yo(new Ri(d,p))}}var Ke=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ue=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Tt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(kr(t,n._jsonSchema))return new n(e,r||null,new x(X.fromString(t.referencePath)))}};ue._jsonSchemaVersion="firestore/documentReference/1.0",ue._jsonSchema={type:ae("string",ue._jsonSchemaVersion),referencePath:ae("string")};var Tt=class n extends Ke{constructor(e,t,r){super(e,t,hs(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ue(this.firestore,null,new x(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function _s(n,e,...t){if(n=ne(n),md("collection","path",e),n instanceof kn){let r=X.fromString(e,...t);return Ph(r),new Tt(n,null,r)}{if(!(n instanceof ue||n instanceof Tt))throw new N(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(X.fromString(e,...t));return Ph(r),new Tt(n.firestore,null,r)}}function Fn(n,e,...t){if(n=ne(n),arguments.length===1&&(e=mr.newId()),md("doc","path",e),n instanceof kn){let r=X.fromString(e,...t);return Rh(r),new ue(n,null,new x(r))}{if(!(n instanceof ue||n instanceof Tt))throw new N(S.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(X.fromString(e,...t));return Rh(r),new ue(n.firestore,n instanceof Tt?n.converter:null,new x(r))}}var ud="AsyncQueue",ns=class{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Wi(this,"async_queue_retry"),this._c=()=>{let r=Ho();r&&V(ud,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;let t=Ho();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=Ho();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new Ve;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Ln(e))throw e;V(ud,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,tt("INTERNAL UNHANDLED ERROR: ",ld(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let i=fc.createAndSchedule(this,e,t,r,o=>this.hc(o));return this.tc.push(i),i}uc(){this.nc&&L(47125,{Pc:ld(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function ld(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function hd(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let o of r)if(o in i&&typeof i[o]=="function")return!0;return!1})(n,["next","error","complete"])}var We=class extends kn{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new ns,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new ns(e),this._firestoreClient=void 0,await e}}};function kf(n,e){let t=typeof n=="object"?n:yi(),r=typeof n=="string"?n:e||Di,i=cr(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=Yl("firestore");o&&Uy(i,...o)}return i}function ys(n){if(n._terminated)throw new N(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||By(n),n._firestoreClient}function By(n){let e=n._freezeSettings(),t=(function(i,o,a,u){return new sa(i,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,Cf(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new vc(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){let o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(n._componentsProvider))}var vt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(_e.fromBase64String(e))}catch(t){throw new N(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(_e.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(kr(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};vt._jsonSchemaVersion="firestore/bytes/1.0",vt._jsonSchema={type:ae("string",vt._jsonSchemaVersion),bytes:ae("string")};var Dn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new N(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Rr=class{constructor(e){this._methodName=e}};var At=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new N(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new N(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return G(this._lat,e._lat)||G(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(kr(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};At._jsonSchemaVersion="firestore/geoPoint/1.0",At._jsonSchema={type:ae("string",At._jsonSchemaVersion),latitude:ae("number"),longitude:ae("number")};var bt=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(kr(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new N(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};bt._jsonSchemaVersion="firestore/vectorValue/1.0",bt._jsonSchema={type:ae("string",bt._jsonSchemaVersion),vectorValues:ae("object")};var qy=/^__.*__$/,Ac=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new $e(e,this.data,this.fieldMask,t,this.fieldTransforms):new Xt(e,this.data,t,this.fieldTransforms)}},rs=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new $e(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Df(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ac:n})}}var bc=class n{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new n(q(q({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return ss(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Df(this.Ac)&&qy.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}},Sc=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ps(e)}Cc(e,t,r,i=!1){return new bc({Ac:e,methodName:t,Dc:r,path:Pe.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Is(n){let e=n._freezeSettings(),t=ps(n._databaseId);return new Sc(n._databaseId,!!e.ignoreUndefinedProperties,t)}function jy(n,e,t,r,i,o={}){let a=n.Cc(o.merge||o.mergeFields?2:0,e,t,i);nu("Data must be an object, but it was:",a,r);let u=Vf(r,a),h,d;if(o.merge)h=new De(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){let p=[];for(let y of o.mergeFields){let w=Rc(e,y,t);if(!a.contains(w))throw new N(S.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);Lf(p,w)||p.push(w)}h=new De(p),d=a.fieldTransforms.filter(y=>h.covers(y.field))}else h=null,d=a.fieldTransforms;return new Ac(new Re(u),h,d)}var is=class n extends Rr{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function zy(n,e,t,r){let i=n.Cc(1,e,t);nu("Data must be an object, but it was:",i,r);let o=[],a=Re.empty();Nt(r,(h,d)=>{let p=ru(e,h,t);d=ne(d);let y=i.yc(p);if(d instanceof is)o.push(p);else{let w=Vr(d,y);w!=null&&(o.push(p),a.set(p,w))}});let u=new De(o);return new rs(a,u,i.fieldTransforms)}function Gy(n,e,t,r,i,o){let a=n.Cc(1,e,t),u=[Rc(e,r,t)],h=[i];if(o.length%2!=0)throw new N(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<o.length;w+=2)u.push(Rc(e,o[w])),h.push(o[w+1]);let d=[],p=Re.empty();for(let w=u.length-1;w>=0;--w)if(!Lf(d,u[w])){let R=u[w],D=h[w];D=ne(D);let O=a.yc(R);if(D instanceof is)d.push(R);else{let C=Vr(D,O);C!=null&&(d.push(R),p.set(R,C))}}let y=new De(d);return new rs(p,y,a.fieldTransforms)}function Of(n,e,t,r=!1){return Vr(t,n.Cc(r?4:3,e))}function Vr(n,e){if(xf(n=ne(n)))return nu("Unsupported field value:",e,n),Vf(n,e);if(n instanceof Rr)return(function(r,i){if(!Df(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){let o=[],a=0;for(let u of r){let h=Vr(u,i.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,i){if((r=ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return A_(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=ee.fromDate(r);return{timestampValue:qi(i.serializer,o)}}if(r instanceof ee){let o=new ee(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:qi(i.serializer,o)}}if(r instanceof At)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof vt)return{bytesValue:sf(i.serializer,r._byteString)};if(r instanceof ue){let o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Gc(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof bt)return(function(a,u){return{mapValue:{fields:{[Mc]:{stringValue:Fc},[vn]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.Sc("VectorValues must only contain numeric values.");return zc(u.serializer,d)})}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${as(r)}`)})(n,e)}function Vf(n,e){let t={};return kd(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Nt(n,(r,i)=>{let o=Vr(i,e.mc(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function xf(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ee||n instanceof At||n instanceof vt||n instanceof ue||n instanceof Rr||n instanceof bt)}function nu(n,e,t){if(!xf(t)||!gd(t)){let r=as(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Rc(n,e,t){if((e=ne(e))instanceof Dn)return e._internalPath;if(typeof e=="string")return ru(n,e);throw ss("Field path arguments must be of type string or ",n,!1,void 0,t)}var $y=new RegExp("[~\\*/\\[\\]]");function ru(n,e,t){if(e.search($y)>=0)throw ss(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Dn(...e.split("."))._internalPath}catch{throw ss(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ss(n,e,t,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new N(S.INVALID_ARGUMENT,u+n+h)}function Lf(n,e){return n.some(t=>t.isEqual(e))}var Pr=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ue(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Pc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(ws("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Pc=class extends Pr{data(){return super.data()}};function ws(n,e){return typeof e=="string"?ru(n,e):e instanceof Dn?e._internalPath:e._delegate._internalPath}function Mf(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new N(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Cr=class{},On=class extends Cr{};function Es(n,e,...t){let r=[];e instanceof Cr&&r.push(e),r=r.concat(t),(function(o){let a=o.filter(h=>h instanceof Cc).length,u=o.filter(h=>h instanceof os).length;if(a>1||a>0&&u>0)throw new N(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(let i of r)n=i._apply(n);return n}var os=class n extends On{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return jf(e._query,t),new Ke(e.firestore,e.converter,ya(e._query,t))}_parse(e){let t=Is(e.firestore);return(function(o,a,u,h,d,p,y){let w;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new N(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){fd(y,p);let D=[];for(let O of y)D.push(dd(h,o,O));w={arrayValue:{values:D}}}else w=dd(h,o,y)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||fd(y,p),w=Of(u,a,y,p==="in"||p==="not-in");return oe.create(d,p,w)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function Ff(n,e,t){let r=e,i=ws("where",n);return os._create(i,r,t)}var Cc=class n extends Cr{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Le.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:((function(i,o){let a=i,u=o.getFlattenedFilters();for(let h of u)jf(a,h),a=ya(a,h)})(e._query,t),new Ke(e.firestore,e.converter,ya(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Nc=class n extends On{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=(function(i,o,a){if(i.startAt!==null)throw new N(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new N(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Qt(o,a)})(e._query,this._field,this._direction);return new Ke(e.firestore,e.converter,(function(i,o){let a=i.explicitOrderBy.concat([o]);return new it(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}};function Uf(n,e="asc"){let t=e,r=ws("orderBy",n);return Nc._create(r,t)}var kc=class n extends On{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Ke(e.firestore,e.converter,Li(e._query,this._limit,this._limitType))}};function Bf(n){return Wg("limit",n),kc._create("limit",n,"F")}var Dc=class n extends On{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=Ky(e,this.type,this._docOrFields,this._inclusive);return new Ke(e.firestore,e.converter,(function(i,o){return new it(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,o,i.endAt)})(e._query,t))}};function qf(...n){return Dc._create("startAfter",n,!1)}function Ky(n,e,t,r){if(t[0]=ne(t[0]),t[0]instanceof Pr)return(function(o,a,u,h,d){if(!h)throw new N(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let p=[];for(let y of yn(o))if(y.field.isKeyField())p.push(Vi(a,h.key));else{let w=h.data.field(y.field);if(us(w))throw new N(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+y.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(w===null){let R=y.field.canonicalString();throw new N(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${R}' (used as the orderBy) does not exist.`)}p.push(w)}return new Rt(p,d)})(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Is(n.firestore);return(function(a,u,h,d,p,y){let w=a.explicitOrderBy;if(p.length>w.length)throw new N(S.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let R=[];for(let D=0;D<p.length;D++){let O=p[D];if(w[D].field.isKeyField()){if(typeof O!="string")throw new N(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof O}`);if(!jc(a)&&O.indexOf("/")!==-1)throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${O}' contains a slash.`);let C=a.path.child(X.fromString(O));if(!x.isDocumentKey(C))throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${C}' is not because it contains an odd number of segments.`);let j=new x(C);R.push(Vi(u,j))}else{let C=Of(h,d,O);R.push(C)}}return new Rt(R,y)})(n._query,n.firestore._databaseId,i,e,t,r)}}function dd(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new N(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!jc(e)&&t.indexOf("/")!==-1)throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(X.fromString(t));if(!x.isDocumentKey(r))throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Vi(n,new x(r))}if(t instanceof ue)return Vi(n,t._key);throw new N(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${as(t)}.`)}function fd(n,e){if(!Array.isArray(n)||n.length===0)throw new N(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function jf(n,e){let t=(function(i,o){for(let a of i)for(let u of a.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new N(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new N(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Oc=class{convertValue(e,t="none"){switch(St(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Z(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(rt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw L(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Nt(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){let t=e.fields?.[vn].arrayValue?.values?.map(r=>Z(r.doubleValue));return new bt(t)}convertGeoPoint(e){return new At(Z(e.latitude),Z(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=ls(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(yr(e));default:return null}}convertTimestamp(e){let t=nt(e);return new ee(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=X.fromString(e);Q(hf(r),9688,{name:e});let i=new Oi(r.get(1),r.get(3)),o=new x(r.popFirst(5));return i.isEqual(t)||tt(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};function Wy(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Gt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},$t=class n extends Pr{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new wn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(ws("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new N(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};$t._jsonSchemaVersion="firestore/documentSnapshot/1.0",$t._jsonSchema={type:ae("string",$t._jsonSchemaVersion),bundleSource:ae("string","DocumentSnapshot"),bundleName:ae("string"),bundle:ae("string")};var wn=class extends $t{data(e={}){return super.data(e)}},Kt=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Gt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new wn(this._firestore,this._userDataWriter,r.key,r,new Gt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new N(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let h=new wn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Gt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{let h=new wn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Gt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:Hy(u.type),doc:h,oldIndex:d,newIndex:p}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new N(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=mr.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function Hy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:n})}}function zf(n){n=Ce(n,ue);let e=Ce(n.firestore,We);return My(ys(e),n._key).then(t=>Wf(e,n,t))}Kt._jsonSchemaVersion="firestore/querySnapshot/1.0",Kt._jsonSchema={type:ae("string",Kt._jsonSchemaVersion),bundleSource:ae("string","QuerySnapshot"),bundleName:ae("string"),bundle:ae("string")};var Nr=class extends Oc{constructor(e){super(),this.firestore=e}convertBytes(e){return new vt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ue(this.firestore,null,t)}};function iu(n){n=Ce(n,Ke);let e=Ce(n.firestore,We),t=ys(e),r=new Nr(e);return Mf(n._query),Fy(t,n._query).then(i=>new Kt(e,r,n,i))}function Gf(n,e,t){n=Ce(n,ue);let r=Ce(n.firestore,We),i=Wy(n.converter,e,t);return ou(r,[jy(Is(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,et.none())])}function $f(n,e,t,...r){n=Ce(n,ue);let i=Ce(n.firestore,We),o=Is(i),a;return a=typeof(e=ne(e))=="string"||e instanceof Dn?Gy(o,"updateDoc",n._key,e,t,r):zy(o,"updateDoc",n._key,e),ou(i,[a.toMutation(n._key,et.exists(!0))])}function Kf(n){return ou(Ce(n.firestore,We),[new wr(n._key,et.none())])}function su(n,...e){n=ne(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||hd(e[r])||(t=e[r++]);let i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(hd(e[r])){let h=e[r];e[r]=h.next?.bind(h),e[r+1]=h.error?.bind(h),e[r+2]=h.complete?.bind(h)}let o,a,u;if(n instanceof ue)a=Ce(n.firestore,We),u=hs(n._key.path),o={next:h=>{e[r]&&e[r](Wf(a,n,h))},error:e[r+1],complete:e[r+2]};else{let h=Ce(n,Ke);a=Ce(h.firestore,We),u=h._query;let d=new Nr(a);o={next:p=>{e[r]&&e[r](new Kt(a,d,h,p))},error:e[r+1],complete:e[r+2]},Mf(n._query)}return(function(d,p,y,w){let R=new Sr(w),D=new br(p,R,y);return d.asyncQueue.enqueueAndForget(async()=>Yc(await es(d),D)),()=>{R.Nu(),d.asyncQueue.enqueueAndForget(async()=>Xc(await es(d),D))}})(ys(a),u,i,o)}function ou(n,e){return(function(r,i){let o=new Ve;return r.asyncQueue.enqueueAndForget(async()=>Sy(await Ly(r),i,o)),o.promise})(ys(n),e)}function Wf(n,e,t){let r=t.docs.get(e._key),i=new Nr(n);return new $t(n,i,e._key,r,new Gt(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){Vn=i})(Et),wt(new Ne("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),u=new We(new Xo(r.getProvider("auth-internal")),new ta(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new N(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Oi(d.options.projectId,p)})(a,i),a);return o=q({useFetchStreams:t},o),u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),Oe(Ah,bh,e),Oe(Ah,bh,"esm2020")})();var Ts={production:!0,firebase:{apiKey:"AIzaSyAx7RlSR3sAtZw32ANQmBeKH6cExpT0_3w",authDomain:"roofrix-d116a.firebaseapp.com",projectId:"roofrix-d116a",storageBucket:"roofrix-d116a.firebasestorage.app",messagingSenderId:"221527874378",appId:"1:221527874378:web:44b5ae36ff78cf7b787fb3",measurementId:"G-V061JEECZ6"}};var Qy="firebase",Jy="12.7.0";Oe(Qy,Jy,"app");var vs=class n{db;constructor(){let e=ur(Ts.firebase,"firestore-app");this.db=kf(e)}async getDocument(e,t){try{let r=Fn(this.db,e,t),i=await zf(r);return i.exists()?q({id:i.id},i.data()):null}catch(r){throw console.error("Error getting document:",r),r}}async getDocuments(e,t=[]){try{let r=_s(this.db,e),i=t.length>0?Es(r,...t):r;return(await iu(i)).docs.map(a=>q({id:a.id},a.data()))}catch(r){throw console.error("Error getting documents:",r),r}}async setDocument(e,t,r){try{let i=Fn(this.db,e,t);await Gf(i,r)}catch(i){throw console.error("Error setting document:",i),i}}async updateDocument(e,t,r){try{let i=Fn(this.db,e,t);await $f(i,be(q({},r),{updatedAt:ee.now()}))}catch(i){throw console.error("Error updating document:",i),i}}async deleteDocument(e,t){try{let r=Fn(this.db,e,t);await Kf(r)}catch(r){throw console.error("Error deleting document:",r),r}}documentListener(e,t){return new mo(r=>{let i=Fn(this.db,e,t),o=su(i,a=>{a.exists()?r.next(q({id:a.id},a.data())):r.next(null)},a=>{console.error("Document listener error:",a),r.error(a)});return()=>o()})}collectionListener(e,t=[]){return new mo(r=>{let i=_s(this.db,e),o=t.length>0?Es(i,...t):i,a=su(o,u=>{let h=u.docs.map(d=>q({id:d.id},d.data()));r.next(h)},u=>{console.error("Collection listener error:",u),r.error(u)});return()=>a()})}getTimestamp(){return ee.now()}timestampToDate(e){return e.toDate()}dateToTimestamp(e){return ee.fromDate(e)}getQueryHelpers(){return{where:Ff,orderBy:Uf,limit:Bf,startAfter:qf}}async getDocumentsWithPagination(e,t=[]){try{let r=_s(this.db,e),i=t.length>0?Es(r,...t):r;return(await iu(i)).docs.map(a=>q({id:a.id},a.data()))}catch(r){throw console.error("Error getting paginated documents:",r),r}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=un({token:n,factory:n.\u0275fac,providedIn:"root"})};var As=class n{firestoreService=rr(vs);USERS_COLLECTION="users";async createUserProfile(e,t){try{let r=this.firestoreService.getTimestamp(),i=q({email:t.email,role:t.role,displayName:t.displayName||"",phoneNumber:t.phoneNumber||"",company:t.company||"",photoURL:"",createdAt:r,updatedAt:r,lastLoginAt:r,isActive:!0},t.role==="designer"&&{assignedOrders:[]});await this.firestoreService.setDocument(this.USERS_COLLECTION,e,i)}catch(r){throw console.error("Error creating user profile:",r),r}}async getUserProfile(e){try{return await this.firestoreService.getDocument(this.USERS_COLLECTION,e)}catch(t){throw console.error("Error getting user profile:",t),t}}async updateUserProfile(e,t){try{let r=t,{id:i,createdAt:o}=r,a=nr(r,["id","createdAt"]);await this.firestoreService.updateDocument(this.USERS_COLLECTION,e,a)}catch(i){throw console.error("Error updating user profile:",i),i}}async updateLastLogin(e){try{await this.firestoreService.updateDocument(this.USERS_COLLECTION,e,{lastLoginAt:this.firestoreService.getTimestamp()})}catch(t){throw console.error("Error updating last login:",t),t}}userProfileListener(e){return this.firestoreService.documentListener(this.USERS_COLLECTION,e)}async getAllUsers(){try{return await this.firestoreService.getDocuments(this.USERS_COLLECTION)}catch(e){throw console.error("Error getting all users:",e),e}}async getUsersByRole(e){try{let{where:t}=this.firestoreService.getQueryHelpers();return await this.firestoreService.getDocuments(this.USERS_COLLECTION,[t("role","==",e),t("isActive","==",!0)])}catch(t){throw console.error("Error getting users by role:",t),t}}async deactivateUser(e){try{await this.firestoreService.updateDocument(this.USERS_COLLECTION,e,{isActive:!1})}catch(t){throw console.error("Error deactivating user:",t),t}}async activateUser(e){try{await this.firestoreService.updateDocument(this.USERS_COLLECTION,e,{isActive:!0})}catch(t){throw console.error("Error activating user:",t),t}}async assignOrderToDesigner(e,t){try{let r=await this.getUserProfile(e);if(!r)throw new Error("Designer not found");if(r.role!=="designer")throw new Error("User is not a designer");let i=r.assignedOrders||[];i.includes(t)||await this.firestoreService.updateDocument(this.USERS_COLLECTION,e,{assignedOrders:[...i,t]})}catch(r){throw console.error("Error assigning order to designer:",r),r}}async removeOrderFromDesigner(e,t){try{let r=await this.getUserProfile(e);if(!r)throw new Error("Designer not found");let o=(r.assignedOrders||[]).filter(a=>a!==t);await this.firestoreService.updateDocument(this.USERS_COLLECTION,e,{assignedOrders:o})}catch(r){throw console.error("Error removing order from designer:",r),r}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=un({token:n,factory:n.\u0275fac,providedIn:"root"})};function lp(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var hp=lp,dp=new Je("auth","Firebase",lp());var Ns=new yt("@firebase/auth");function Yy(n,...e){Ns.logLevel<=z.WARN&&Ns.warn(`Auth (${Et}): ${n}`,...e)}function Ss(n,...e){Ns.logLevel<=z.ERROR&&Ns.error(`Auth (${Et}): ${n}`,...e)}function Qe(n,...e){throw ku(n,...e)}function tn(n,...e){return ku(n,...e)}function fp(n,e,t){let r=be(q({},hp()),{[e]:t});return new Je("auth","Firebase",r).create(e,{appName:n.name})}function ut(n){return fp(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ku(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return dp.create(n,...e)}function M(n,e,...t){if(!n)throw ku(e,...t)}function at(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Ss(e),new Error(e)}function Ot(n,e){n||at(e)}function lu(){return typeof self<"u"&&self.location?.href||""}function Xy(){return Qf()==="http:"||Qf()==="https:"}function Qf(){return typeof self<"u"&&self.location?.protocol||null}function Zy(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Xy()||th()||"connection"in navigator)?navigator.onLine:!0}function eI(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var nn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ot(t>e,"Short delay should be less than long delay!"),this.isMobile=Zl()||nh()}get(){return Zy()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Du(n,e){Ot(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var ks=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;at("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;at("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;at("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var tI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var nI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],rI=new nn(3e4,6e4);function Vt(n,e){return n.tenantId&&!e.tenantId?be(q({},e),{tenantId:n.tenantId}):e}async function xt(n,e,t,r,i={}){return pp(n,i,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});let u=or(q({key:n.config.apiKey},a)).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);let d=q({method:e,headers:h},o);return eh()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&_t(n.emulatorConfig.host)&&(d.credentials="include"),ks.fetch()(await mp(n,n.config.apiHost,t,u),d)})}async function pp(n,e,t){n._canInitEmulator=!1;let r=q(q({},tI),e);try{let i=new hu(n),o=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=await o.json();if("needConfirmation"in a)throw bs(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{let u=o.ok?a.errorMessage:a.error.message,[h,d]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw bs(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw bs(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw bs(n,"user-disabled",a);let p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw fp(n,p,d);Qe(n,p)}}catch(i){if(i instanceof Se)throw i;Qe(n,"network-request-failed",{message:String(i)})}}async function zr(n,e,t,r,i={}){let o=await xt(n,e,t,r,i);return"mfaPendingCredential"in o&&Qe(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function mp(n,e,t,r){let i=`${e}${t}?${r}`,o=n,a=o.config.emulator?Du(n.config,i):`${n.config.apiScheme}://${i}`;return nI.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}function iI(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var hu=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(tn(this.auth,"network-request-failed")),rI.get())})}};function bs(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=tn(n,e,r);return i.customData._tokenResponse=t,i}function Jf(n){return n!==void 0&&n.enterprise!==void 0}var du=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return iI(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};async function sI(n,e){return xt(n,"GET","/v2/recaptchaConfig",Vt(n,e))}async function oI(n,e){return xt(n,"POST","/v1/accounts:delete",e)}async function Ds(n,e){return xt(n,"POST","/v1/accounts:lookup",e)}function Lr(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function gp(n,e=!1){let t=ne(n),r=await t.getIdToken(e),i=Ou(r);M(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let o=typeof i.firebase=="object"?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:Lr(au(i.auth_time)),issuedAtTime:Lr(au(i.iat)),expirationTime:Lr(au(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function au(n){return Number(n)*1e3}function Ou(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ss("JWT malformed, contained fewer than 3 sections"),null;try{let i=hi(t);return i?JSON.parse(i):(Ss("Failed to decode base64 JWT payload"),null)}catch(i){return Ss("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Yf(n){let e=Ou(n);return M(e,"internal-error"),M(typeof e.exp<"u","internal-error"),M(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Fr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Se&&aI(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function aI({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var fu=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){let t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;let r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}};var Ur=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Lr(this.lastLoginAt),this.creationTime=Lr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};async function Os(n){let e=n.auth,t=await n.getIdToken(),r=await Fr(n,Ds(e,{idToken:t}));M(r?.users.length,e,"internal-error");let i=r.users[0];n._notifyReloadListener(i);let o=i.providerUserInfo?.length?yp(i.providerUserInfo):[],a=cI(n.providerData,o),u=n.isAnonymous,h=!(n.email&&i.passwordHash)&&!a?.length,d=u?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Ur(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,p)}async function _p(n){let e=ne(n);await Os(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function cI(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function yp(n){return n.map(r=>{var i=r,{providerId:e}=i,t=nr(i,["providerId"]);return{providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}})}async function uI(n,e){let t=await pp(n,{},async()=>{let r=or({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=await mp(n,i,"/v1/token",`key=${o}`),u=await n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";let h={method:"POST",headers:u,body:r};return n.emulatorConfig&&_t(n.emulatorConfig.host)&&(h.credentials="include"),ks.fetch()(a,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function lI(n,e){return xt(n,"POST","/v2/accounts:revokeToken",Vt(n,e))}var Mr=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){M(e.idToken,"internal-error"),M(typeof e.idToken<"u","internal-error"),M(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Yf(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){M(e.length!==0,"internal-error");let t=Yf(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(M(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:i,expiresIn:o}=await uI(e,t);this.updateTokensAndExpiration(r,i,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new n;return r&&(M(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(M(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(M(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return at("not implemented")}};function kt(n,e){M(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var Dt=class n{constructor(o){var a=o,{uid:e,auth:t,stsTokenManager:r}=a,i=nr(a,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new fu(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Ur(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await Fr(this,this.stsTokenManager.getToken(this.auth,e));return M(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return gp(this,e)}reload(){return _p(this)}_assign(e){this!==e&&(M(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>q({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(be(q({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){M(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Os(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ve(this.auth.app))return Promise.reject(ut(this.auth));let e=await this.getIdToken();return await Fr(this,oI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return be(q({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>q({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,i=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,u=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:y,emailVerified:w,isAnonymous:R,providerData:D,stsTokenManager:O}=t;M(y&&O,e,"internal-error");let C=Mr.fromJSON(this.name,O);M(typeof y=="string",e,"internal-error"),kt(r,e.name),kt(i,e.name),M(typeof w=="boolean",e,"internal-error"),M(typeof R=="boolean",e,"internal-error"),kt(o,e.name),kt(a,e.name),kt(u,e.name),kt(h,e.name),kt(d,e.name),kt(p,e.name);let j=new n({uid:y,auth:e,email:i,emailVerified:w,displayName:r,isAnonymous:R,photoURL:a,phoneNumber:o,tenantId:u,stsTokenManager:C,createdAt:d,lastLoginAt:p});return D&&Array.isArray(D)&&(j.providerData=D.map(W=>q({},W))),h&&(j._redirectEventId=h),j}static async _fromIdTokenResponse(e,t,r=!1){let i=new Mr;i.updateFromServerResponse(t);let o=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Os(o),o}static async _fromGetAccountInfoResponse(e,t,r){let i=t.users[0];M(i.localId!==void 0,"internal-error");let o=i.providerUserInfo!==void 0?yp(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!o?.length,u=new Mr;u.updateFromIdToken(r);let h=new n({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Ur(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,d),h}};var Xf=new Map;function ct(n){Ot(n instanceof Function,"Expected a class definition");let e=Xf.get(n);return e?(Ot(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Xf.set(n,e),e)}var hI=(()=>{class n{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,r){this.storage[t]=r}async _get(t){let r=this.storage[t];return r===void 0?null:r}async _remove(t){delete this.storage[t]}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),pu=hI;function Rs(n,e,t){return`firebase:${n}:${e}:${t}`}var Vs=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:o}=this.auth;this.fullUserKey=Rs(this.userKey,i.apiKey,o),this.fullPersistenceKey=Rs("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=await Ds(this.auth,{idToken:e}).catch(()=>{});return t?Dt._fromGetAccountInfoResponse(this.auth,t,e):null}return Dt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new n(ct(pu),e,r);let i=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d),o=i[0]||ct(pu),a=Rs(r,e.config.apiKey,e.name),u=null;for(let d of t)try{let p=await d._get(a);if(p){let y;if(typeof p=="string"){let w=await Ds(e,{idToken:p}).catch(()=>{});if(!w)break;y=await Dt._fromGetAccountInfoResponse(e,w,p)}else y=Dt._fromJSON(e,p);d!==o&&(u=y),o=d;break}}catch{}let h=i.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new n(o,e,r):(o=h[0],u&&await o._set(a,u.toJSON()),await Promise.all(t.map(async d=>{if(d!==o)try{await d._remove(a)}catch{}})),new n(o,e,r))}};function Zf(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Tp(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ip(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Ap(e))return"Blackberry";if(bp(e))return"Webos";if(wp(e))return"Safari";if((e.includes("chrome/")||Ep(e))&&!e.includes("edge/"))return"Chrome";if(vp(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Ip(n=de()){return/firefox\//i.test(n)}function wp(n=de()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ep(n=de()){return/crios\//i.test(n)}function Tp(n=de()){return/iemobile/i.test(n)}function vp(n=de()){return/android/i.test(n)}function Ap(n=de()){return/blackberry/i.test(n)}function bp(n=de()){return/webos/i.test(n)}function Vu(n=de()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function dI(n=de()){return Vu(n)&&!!window.navigator?.standalone}function fI(){return rh()&&document.documentMode===10}function Sp(n=de()){return Vu(n)||vp(n)||bp(n)||Ap(n)||/windows phone/i.test(n)||Tp(n)}function Rp(n,e=[]){let t;switch(n){case"Browser":t=Zf(de());break;case"Worker":t=`${Zf(de())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Et}/${r}`}var mu=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=o=>new Promise((a,u)=>{try{let h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}};async function pI(n,e={}){return xt(n,"GET","/v2/passwordPolicy",Vt(n,e))}var mI=6,gu=class{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??mI,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}};var _u=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xs(this),this.idTokenSubscription=new xs(this),this.beforeStateQueue=new mu(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dp,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ct(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Vs.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await Ds(this,{idToken:e}),r=await Dt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(ve(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&u?.user&&(r=u.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return M(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Os(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=eI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ve(this.app))return Promise.reject(ut(this));let t=e?ne(e):null;return t&&M(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&M(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ve(this.app)?Promise.reject(ut(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ve(this.app)?Promise.reject(ut(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ct(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=await pI(this),t=new gu(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Je("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await lI(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&ct(e)||this._popupRedirectResolver;M(t,this,"argument-error"),this.redirectPersistenceManager=await Vs.create(this,[ct(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let o=typeof t=="function"?t:t.next.bind(t),a=!1,u=this._isInitialized?Promise.resolve():this._initializationPromise;if(M(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){let h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{let h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return M(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Rp(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(ve(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Yy(`Error while retrieving App Check token: ${e.error}`),e?.token}};function sn(n){return ne(n)}var xs=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=ah(t=>this.observer=t)}get next(){return M(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var js={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function gI(n){js=n}function Pp(n){return js.loadJS(n)}function _I(){return js.recaptchaEnterpriseScript}function yI(){return js.gapiScript}function Cp(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var yu=class{constructor(){this.enterprise=new Iu}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},Iu=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}};var II="recaptcha-enterprise",Np="NO_RECAPTCHA",wu=class{constructor(e){this.type=II,this.auth=sn(e)}async verify(e="verify",t=!1){async function r(o){if(!t){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,u)=>{sI(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{let d=new du(h);return o.tenantId==null?o._agentRecaptchaConfig=d:o._tenantRecaptchaConfigs[o.tenantId]=d,a(d.siteKey)}}).catch(h=>{u(h)})})}function i(o,a,u){let h=window.grecaptcha;Jf(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(d=>{a(d)}).catch(()=>{a(Np)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new yu().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{r(this.auth).then(u=>{if(!t&&Jf(window.grecaptcha))i(u,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let h=_I();h.length!==0&&(h+=u),Pp(h).then(()=>{i(u,o,a)}).catch(d=>{a(d)})}}).catch(u=>{a(u)})})}};async function xr(n,e,t,r=!1,i=!1){let o=new wu(n),a;if(i)a=Np;else try{a=await o.verify(t)}catch{a=await o.verify(t,!0)}let u=q({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){let h=u.phoneEnrollmentInfo.phoneNumber,d=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){let h=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:a}):Object.assign(u,{captchaResponse:a}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function Eu(n,e,t,r,i){if(i==="EMAIL_PASSWORD_PROVIDER")if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let o=await xr(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let a=await xr(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(o)});else if(i==="PHONE_PROVIDER")if(n._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let o=await xr(n,e,t);return r(n,o).catch(async a=>{if(n._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&(a.code==="auth/missing-recaptcha-token"||a.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let u=await xr(n,e,t,!1,!0);return r(n,u)}return Promise.reject(a)})}else{let o=await xr(n,e,t,!1,!0);return r(n,o)}else return Promise.reject(i+" provider is not supported.")}function kp(n,e){let t=cr(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),o=t.getOptions();if(Ue(o,e??{}))return i;Qe(i,"already-initialized")}return t.initialize({options:e})}function wI(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(ct);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Dp(n,e,t){let r=sn(n);M(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,o=Op(e),{host:a,port:u}=EI(e),h=u===null?"":`:${u}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){M(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),M(Ue(d,r.config.emulator)&&Ue(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,_t(a)?(fi(`${o}//${a}${h}`),pi("Auth",!0)):i||TI()}function Op(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function EI(n){let e=Op(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let o=i[1];return{host:o,port:ep(r.substr(o.length+1))}}else{let[o,a]=r.split(":");return{host:o,port:ep(a)}}}function ep(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function TI(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var Br=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return at("not implemented")}_getIdTokenResponse(e){return at("not implemented")}_linkToIdToken(e,t){return at("not implemented")}_getReauthenticationResolver(e){return at("not implemented")}};async function vI(n,e){return xt(n,"POST","/v1/accounts:signUp",e)}async function AI(n,e){return zr(n,"POST","/v1/accounts:signInWithPassword",Vt(n,e))}async function bI(n,e){return zr(n,"POST","/v1/accounts:signInWithEmailLink",Vt(n,e))}async function SI(n,e){return zr(n,"POST","/v1/accounts:signInWithEmailLink",Vt(n,e))}var qr=class n extends Br{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Eu(e,t,"signInWithPassword",AI,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return bI(e,{email:this._email,oobCode:this._password});default:Qe(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Eu(e,r,"signUpPassword",vI,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return SI(e,{idToken:t,email:this._email,oobCode:this._password});default:Qe(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};async function cu(n,e){return zr(n,"POST","/v1/accounts:signInWithIdp",Vt(n,e))}function RI(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function PI(n){let e=ln(hn(n)).link,t=e?ln(hn(e)).deep_link_id:null,r=ln(hn(n)).deep_link_id;return(r?ln(hn(r)).link:null)||r||t||e||n}var Ls=class n{constructor(e){let t=ln(hn(e)),r=t.apiKey??null,i=t.oobCode??null,o=RI(t.mode??null);M(r&&i&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t=PI(e);try{return new n(t)}catch{return null}}};var Vp=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return qr._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=Ls.parseLink(r);return M(i,"argument-error"),qr._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),Ms=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var Tu=class extends Ms{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};async function CI(n,e){return zr(n,"POST","/v1/accounts:signUp",Vt(n,e))}var Un=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){let o=await Dt._fromIdTokenResponse(e,r,i),a=tp(r);return new n({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);let i=tp(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})}};function tp(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var vu=class n extends Se{constructor(e,t,r,i){super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function xp(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?vu._fromErrorAndOperation(n,o,e,r):o})}async function NI(n,e,t=!1){let r=await Fr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Un._forOperation(n,"link",r)}async function kI(n,e,t=!1){let{auth:r}=n;if(ve(r.app))return Promise.reject(ut(r));let i="reauthenticate";try{let o=await Fr(n,xp(r,i,e,n),t);M(o.idToken,r,"internal-error");let a=Ou(o.idToken);M(a,r,"internal-error");let{sub:u}=a;return M(n.uid===u,r,"user-mismatch"),Un._forOperation(n,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&Qe(r,"user-mismatch"),o}}async function Lp(n,e,t=!1){if(ve(n.app))return Promise.reject(ut(n));let r="signIn",i=await xp(n,r,e),o=await Un._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(o.user),o}async function Mp(n,e){return Lp(sn(n),e)}async function Fp(n){let e=sn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function xu(n,e,t){if(ve(n.app))return Promise.reject(ut(n));let r=sn(n),a=await Eu(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",CI,"EMAIL_PASSWORD_PROVIDER").catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&Fp(n),h}),u=await Un._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(u.user),u}function Lu(n,e,t){return ve(n.app)?Promise.reject(ut(n)):Mp(ne(n),Vp.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Fp(n),r})}function Up(n,e,t,r){return ne(n).onIdTokenChanged(e,t,r)}function Bp(n,e,t){return ne(n).beforeAuthStateChanged(e,t)}function Mu(n,e,t,r){return ne(n).onAuthStateChanged(e,t,r)}function Fu(n){return ne(n).signOut()}var Fs="__sak";var Us=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Fs,"1"),this.storage.removeItem(Fs),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var DI=1e3,OI=10,VI=(()=>{class n extends Us{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Sp(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),o=this.localCache[r];i!==o&&t(r,o,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((u,h,d)=>{this.notifyListeners(u,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let o=()=>{let u=this.storage.getItem(i);!r&&this.localCache[i]===u||this.notifyListeners(i,u)},a=this.storage.getItem(i);fI()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(o,OI):o()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},DI)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,r){await super._set(t,r),this.localCache[t]=JSON.stringify(r)}async _get(t){let r=await super._get(t);return this.localCache[t]=JSON.stringify(r),r}async _remove(t){await super._remove(t),delete this.localCache[t]}}return n.type="LOCAL",n})(),qp=VI;var xI=(()=>{class n extends Us{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),Uu=xI;function LI(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}var MI=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(o=>o.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}async handleEvent(t){let r=t,{eventId:i,eventType:o,data:a}=r.data,u=this.handlersMap[o];if(!u?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:o});let h=Array.from(u).map(async p=>p(r.origin,a)),d=await LI(h);r.ports[0].postMessage({status:"done",eventId:i,eventType:o,response:d})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function jp(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var Au=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,a;return new Promise((u,h)=>{let d=jp("",20);i.port1.start();let p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(y){let w=y;if(w.data.eventId===d)switch(w.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(w.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}};function He(){return window}function FI(n){He().location.href=n}function zp(){return typeof He().WorkerGlobalScope<"u"&&typeof He().importScripts=="function"}async function UI(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function BI(){return navigator?.serviceWorker?.controller||null}function qI(){return zp()?self:null}var Gp="firebaseLocalStorageDb",jI=1,Bs="firebaseLocalStorage",$p="fbase_key",rn=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function zs(n,e){return n.transaction([Bs],e?"readwrite":"readonly").objectStore(Bs)}function zI(){let n=indexedDB.deleteDatabase(Gp);return new rn(n).toPromise()}function bu(){let n=indexedDB.open(Gp,jI);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(Bs,{keyPath:$p})}catch(i){t(i)}}),n.addEventListener("success",async()=>{let r=n.result;r.objectStoreNames.contains(Bs)?e(r):(r.close(),await zI(),e(await bu()))})})}async function np(n,e,t){let r=zs(n,!0).put({[$p]:e,value:t});return new rn(r).toPromise()}async function GI(n,e){let t=zs(n,!1).get(e),r=await new rn(t).toPromise();return r===void 0?null:r.value}function rp(n,e){let t=zs(n,!0).delete(e);return new rn(t).toPromise()}var $I=800,KI=3,WI=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await bu(),this.db)}async _withRetries(t){let r=0;for(;;)try{let i=await this._openDb();return await t(i)}catch(i){if(r++>KI)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return zp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=MI._getInstance(qI()),this.receiver._subscribe("keyChanged",async(t,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(t,r)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await UI(),!this.activeServiceWorker)return;this.sender=new Au(this.activeServiceWorker);let t=await this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||BI()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let t=await bu();return await np(t,Fs,"1"),await rp(t,Fs),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,r){return this._withPendingWrite(async()=>(await this._withRetries(i=>np(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)))}async _get(t){let r=await this._withRetries(i=>GI(i,t));return this.localCache[t]=r,r}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(r=>rp(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){let t=await this._withRetries(o=>{let a=zs(o,!1).getAll();return new rn(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:o,value:a}of t)i.add(o),JSON.stringify(this.localCache[o])!==JSON.stringify(a)&&(this.notifyListeners(o,a),r.push(o));for(let o of Object.keys(this.localCache))this.localCache[o]&&!i.has(o)&&(this.notifyListeners(o,null),r.push(o));return r}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),$I)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Kp=WI;var nT=Cp("rcb"),rT=new nn(3e4,6e4);function HI(n,e){return e?ct(e):(M(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var jr=class extends Br{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return cu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return cu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return cu(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function QI(n){return Lp(n.auth,new jr(n),n.bypassAuthState)}function JI(n){let{auth:e,user:t}=n;return M(t,e,"internal-error"),kI(t,new jr(n),n.bypassAuthState)}async function YI(n){let{auth:e,user:t}=n;return M(t,e,"internal-error"),NI(t,new jr(n),n.bypassAuthState)}var Su=class{constructor(e,t,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:i,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}let h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return QI;case"linkViaPopup":case"linkViaRedirect":return YI;case"reauthViaPopup":case"reauthViaRedirect":return JI;default:Qe(this.auth,"internal-error")}}resolve(e){Ot(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ot(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var iT=new nn(2e3,1e4);var XI="pendingRedirect",Ps=new Map,Ru=class extends Su{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Ps.get(this.auth._key());if(!e){try{let r=await ZI(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ps.set(this.auth._key(),e)}return this.bypassAuthState||Ps.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}};async function ZI(n,e){let t=nw(e),r=tw(n);if(!await r._isAvailable())return!1;let i=await r._get(t)==="true";return await r._remove(t),i}function ew(n,e){Ps.set(n._key(),e)}function tw(n){return ct(n._redirectPersistence)}function nw(n){return Rs(XI,n.config.apiKey,n.name)}async function rw(n,e,t=!1){if(ve(n.app))return Promise.reject(ut(n));let r=sn(n),i=HI(r,e),a=await new Ru(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}var iw=600*1e3,Pu=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!sw(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Wp(e)){let r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(tn(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=iw&&this.cachedEventUids.clear(),this.cachedEventUids.has(ip(e))}saveEventToCache(e){this.cachedEventUids.add(ip(e)),this.lastProcessedEventTime=Date.now()}};function ip(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Wp({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function sw(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Wp(n);default:return!1}}async function ow(n,e={}){return xt(n,"GET","/v1/projects",e)}var aw=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cw=/^https?/;async function uw(n){if(n.config.emulator)return;let{authorizedDomains:e}=await ow(n);for(let t of e)try{if(lw(t))return}catch{}Qe(n,"unauthorized-domain")}function lw(n){let e=lu(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!cw.test(t))return!1;if(aw.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var hw=new nn(3e4,6e4);function sp(){let n=He().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function dw(n){return new Promise((e,t)=>{function r(){sp(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{sp(),t(tn(n,"network-request-failed"))},timeout:hw.get()})}if(He().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(He().gapi?.load)r();else{let i=Cp("iframefcb");return He()[i]=()=>{gapi.load?r():t(tn(n,"network-request-failed"))},Pp(`${yI()}?onload=${i}`).catch(o=>t(o))}}).catch(e=>{throw Cs=null,e})}var Cs=null;function fw(n){return Cs=Cs||dw(n),Cs}var pw=new nn(5e3,15e3),mw="__/auth/iframe",gw="emulator/auth/iframe",_w={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},yw=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Iw(n){let e=n.config;M(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?Du(e,gw):`https://${n.config.authDomain}/${mw}`,r={apiKey:e.apiKey,appName:n.name,v:Et},i=yw.get(n.config.apiHost);i&&(r.eid=i);let o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${or(r).slice(1)}`}async function ww(n){let e=await fw(n),t=He().gapi;return M(t,n,"internal-error"),e.open({where:document.body,url:Iw(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:_w,dontclear:!0},r=>new Promise(async(i,o)=>{await r.restyle({setHideOnLeave:!1});let a=tn(n,"network-request-failed"),u=He().setTimeout(()=>{o(a)},pw.get());function h(){He().clearTimeout(u),i(r)}r.ping(h).then(h,()=>{o(a)})}))}var Ew={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Tw=500,vw=600,Aw="_blank",bw="http://localhost",qs=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function Sw(n,e,t,r=Tw,i=vw){let o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),u="",h=be(q({},Ew),{width:r.toString(),height:i.toString(),top:o,left:a}),d=de().toLowerCase();t&&(u=Ep(d)?Aw:t),Ip(d)&&(e=e||bw,h.scrollbars="yes");let p=Object.entries(h).reduce((w,[R,D])=>`${w}${R}=${D},`,"");if(dI(d)&&u!=="_self")return Rw(e||"",u),new qs(null);let y=window.open(e||"",u,p);M(y,n,"popup-blocked");try{y.focus()}catch{}return new qs(y)}function Rw(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var Pw="__/auth/handler",Cw="emulator/auth/handler",Nw=encodeURIComponent("fac");async function op(n,e,t,r,i,o){M(n.config.authDomain,n,"auth-domain-config-required"),M(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Et,eventId:i};if(e instanceof Ms){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",oh(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[p,y]of Object.entries(o||{}))a[p]=y}if(e instanceof Tu){let p=e.getScopes().filter(y=>y!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);let u=a;for(let p of Object.keys(u))u[p]===void 0&&delete u[p];let h=await n._getAppCheckToken(),d=h?`#${Nw}=${encodeURIComponent(h)}`:"";return`${kw(n)}?${or(u).slice(1)}${d}`}function kw({config:n}){return n.emulator?Du(n,Cw):`https://${n.authDomain}/${Pw}`}var uu="webStorageSupport",Cu=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Uu,this._completeRedirectFn=rw,this._overrideRedirectResult=ew}async _openPopup(e,t,r,i){Ot(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");let o=await op(e,t,r,lu(),i);return Sw(e,o,jp())}async _openRedirect(e,t,r,i){await this._originValidation(e);let o=await op(e,t,r,lu(),i);return FI(o),new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:o}=this.eventManagers[t];return i?Promise.resolve(i):(Ot(o,"If manager is not set, promise should be"),o)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await ww(e),r=new Pu(e);return t.register("authEvent",i=>(M(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(uu,{type:uu},i=>{let o=i?.[0]?.[uu];o!==void 0&&t(!!o),Qe(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=uw(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Sp()||wp()||Vu()}},Hp=Cu;var ap="@firebase/auth",cp="1.12.0";var Nu=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){M(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function Dw(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Ow(n){wt(new Ne("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;M(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Rp(n)},d=new _u(r,i,o,h);return wI(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),wt(new Ne("auth-internal",e=>{let t=sn(e.getProvider("auth").getImmediate());return(r=>new Nu(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Oe(ap,cp,Dw(n)),Oe(ap,cp,"esm2020")}var Vw=300,xw=vo("authIdTokenMaxAge")||Vw,up=null,Lw=n=>async e=>{let t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>xw)return;let i=t?.token;up!==i&&(up=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Bu(n=yi()){let e=cr(n,"auth");if(e.isInitialized())return e.getImmediate();let t=kp(n,{popupRedirectResolver:Hp,persistence:[Kp,qp,Uu]}),r=vo("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let o=new URL(r,location.origin);if(location.origin===o.origin){let a=Lw(o.toString());Bp(t,a,()=>a(t.currentUser)),Up(t,u=>a(u))}}let i=Eo("auth");return i&&Dp(t,`http://${i}`),t}function Mw(){return document.getElementsByTagName("head")?.[0]??document}gI({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let o=tn("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",Mw().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Ow("Browser");var Qp=class n{router=rr(Gl);userService=rr(As);firebaseApp;auth;currentUserSubject=new oi(null);currentUser$=this.currentUserSubject.asObservable();isAuthenticatedSubject=new oi(!1);isAuthenticated$=this.isAuthenticatedSubject.asObservable();loadingSubject=new oi(!0);loading$=this.loadingSubject.asObservable();constructor(){this.firebaseApp=ur(Ts.firebase),this.auth=Bu(this.firebaseApp),this.initAuthStateListener()}initAuthStateListener(){Mu(this.auth,e=>{if(e){let t={uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,emailVerified:e.emailVerified};this.currentUserSubject.next(t),this.isAuthenticatedSubject.next(!0)}else this.currentUserSubject.next(null),this.isAuthenticatedSubject.next(!1);this.loadingSubject.next(!1)})}signUp(e,t){return this.loadingSubject.next(!0),ai(xu(this.auth,e.trim(),t)).pipe(go(async r=>{try{return await this.userService.createUserProfile(r.user.uid,{email:r.user.email||e.trim(),role:"customer",displayName:r.user.displayName||""}),this.loadingSubject.next(!1),{success:!0,uid:r.user.uid}}catch(i){return console.error("Error creating user profile:",i),this.loadingSubject.next(!1),{success:!1,error:"Account created but profile setup failed. Please contact support.",uid:r.user.uid}}}),ui(r=>{console.error("Firebase Auth Error:",r.code,r.message),this.loadingSubject.next(!1);let i=_o(r.code);return ci({success:!1,error:i})}))}signIn(e,t){return this.loadingSubject.next(!0),ai(Lu(this.auth,e.trim(),t)).pipe(go(async r=>{try{return await this.userService.updateLastLogin(r.user.uid),this.loadingSubject.next(!1),{success:!0}}catch(i){return console.error("Error updating last login:",i),this.loadingSubject.next(!1),{success:!0}}}),ui(r=>{console.error("Firebase Sign In Error:",r),console.error("Error code:",r?.code),console.error("Error message:",r?.message),this.loadingSubject.next(!1);let i=_o(r?.code||"unknown");return ci({success:!1,error:i})}))}signOutUser(){return ai(Fu(this.auth)).pipe(zl(()=>(this.router.navigate(["/"]),{success:!0})),ui(e=>ci({success:!1,error:"Failed to sign out. Please try again."})))}getCurrentUser(){return this.currentUserSubject.value}isAuthenticated(){return this.isAuthenticatedSubject.value}isLoading(){return this.loadingSubject.value}static \u0275fac=function(t){return new(t||n)};static \u0275prov=un({token:n,factory:n.\u0275fac,providedIn:"root"})};export{Rm as a,Fw as b,Uw as c,vs as d,As as e,Qp as f};
